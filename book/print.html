<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./mdbook-admonish.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">DevOps</li><li class="chapter-item expanded "><a href="devopt_introduction.html"><strong aria-hidden="true">1.</strong> แนวคิด DevOps</a></li><li class="chapter-item expanded "><a href="cicd.html"><strong aria-hidden="true">2.</strong> แนวคิด CI/CD</a></li><li class="chapter-item expanded affix "><li class="part-title">Setup Environment</li><li class="chapter-item expanded "><a href="prepareration/setup_vagrant.html"><strong aria-hidden="true">3.</strong> Setup Vagrant</a></li><li class="chapter-item expanded "><a href="prepareration/vagrant_workshop.html"><strong aria-hidden="true">4.</strong> vagrant workshop: LAMP Stack</a></li><li class="chapter-item expanded "><a href="prepareration/vagrant_docker.html"><strong aria-hidden="true">5.</strong> vagrant workshop: Docker host</a></li><li class="chapter-item expanded affix "><li class="part-title">Ansible1</li><li class="chapter-item expanded "><a href="module1/ansible_introduction.html"><strong aria-hidden="true">6.</strong> แนะนำ Ansible</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="module1/ssh_key.html"><strong aria-hidden="true">6.1.</strong> การสร้าง ssh-key</a></li><li class="chapter-item expanded "><a href="module1/yaml_basic.html"><strong aria-hidden="true">6.2.</strong> การใช้งาน yaml</a></li></ol></li><li class="chapter-item expanded "><a href="module1/workshop_ansble.html"><strong aria-hidden="true">7.</strong> Workshop Ansible</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="muict-devops"><a class="header" href="#muict-devops">muict-devops</a></h1>
<p>Practical DevOps</p>
<ol>
<li>Introduction to DevOps and CI/CD, Vagrant</li>
<li>Ansible (1)</li>
<li>Ansible (2)</li>
<li>Introduction to Containerization and Docker (1)</li>
<li>Docker (2)</li>
<li>Introduction to container orchestration and Kubernetes (1)</li>
<li>Kubernetes (2)</li>
<li>Application deployment</li>
<li>–Midterm--</li>
<li>CI/CD Pipeline and GitLab (1)</li>
<li>GitLab, GitOps (2)</li>
<li>Jenkins (1)</li>
<li>Jenkins (2)</li>
<li>Infrastructure as Code and Terraform</li>
<li>Python Automation</li>
<li>DevSecOps</li>
<li>–Final--</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="แนวคิด-devops"><a class="header" href="#แนวคิด-devops">แนวคิด DevOps</a></h1>
<h2 id="devops-คืออะไร"><a class="header" href="#devops-คืออะไร">DevOps คืออะไร</a></h2>
<p>DevOps คือ การนำแนวคิดของการพัฒนาซอฟต์แวร์ (Development) และการดำเนินการ (Operations) มารวมกัน เพื่อสร้างความร่วมมือระหว่างทีมพัฒนาและทีมปฏิบัติการไอที ทำให้กระบวนการผลิตและการปรับใช้ซอฟต์แวร์เป็นไปอย่างอัตโนมัติและสามารถทำซ้ำได้ โดยแก้ไขปัญหาเดิม ๆ และนำระบบอัตโนมัติมาใช้ในทุกขั้นตอนของวงจรชีวิตการพัฒนาซอฟต์แวร์ (SDLC) เน้นที่การทำงานร่วมกันของทีมงาน การใช้เครื่องมืออัตโนมัติ และการส่งมอบซอฟต์แวร์ที่สม่ำเสมอ</p>
<p>DevOps คือ ชุดแนวทางปฏิบัติที่รวมเอาการพัฒนาซอฟต์แวร์ (Dev) และการดำเนินการไอที (Ops) เข้าด้วยกัน มีอิทธิพลต่อวงจรชีวิตของแอปพลิเคชันตลอดทุกขั้นตอน ตั้งแต่การวางแผน การพัฒนา การส่งมอบ และการดำเนินการ  หลักการสำคัญของ DevOps รวมถึงการยอมรับวัฒนธรรม DevOps การนำแนวทางปฏิบัติ DevOps มาใช้ และการสร้างบริการที่พร้อมให้ใช้งานตลอดเวลา</p>
<h2 id="devops-กับ-ระบบอัตโนมัติ"><a class="header" href="#devops-กับ-ระบบอัตโนมัติ">DevOps กับ ระบบอัตโนมัติ</a></h2>
<p>DevOps ให้เน้นที่การทำงานร่วมกัน, เครื่องมืออัตโนมัติ และการส่งมอบซอฟต์แวร์ที่สม่ำเสมอ
จากที่คุณเน้นย้ำถึง 3 ประเด็นหลักคือ การทำงานร่วมกัน, เครื่องมืออัตโนมัติ และการส่งมอบซอฟต์แวร์ที่สม่ำเสมอ ลองปรับเนื้อหาให้มีความเจาะจงมากขึ้นดังนี้</p>
<ol>
<li>การทำงานร่วมกัน
เน้นวัฒนธรรมองค์กร:
สร้างวัฒนธรรมองค์กรที่เปิดกว้าง ส่งเสริมการแบ่งปันความรู้ และการทำงานเป็นทีม
สร้างช่องทางการสื่อสารที่สะดวกและมีประสิทธิภาพ เช่น การประชุมร่วมกันเป็นประจำ, ช่องทางการแชท หรือแพลตฟอร์มสำหรับร่วมกันทำงาน
บทบาทของแต่ละฝ่าย:
อธิบายบทบาทและความรับผิดชอบของแต่ละฝ่ายในทีม DevOps อย่างชัดเจน
เน้นความสำคัญของการทำงานข้ามสายงาน (Cross-functional)
เครื่องมือสำหรับการทำงานร่วมกัน:
แนะนำเครื่องมือที่ช่วยในการทำงานร่วมกัน เช่น Jira, Trello, Confluence, Slack เป็นต้น</li>
<li>เครื่องมืออัตโนมัติ
ประโยชน์ของการใช้เครื่องมืออัตโนมัติ:
ลดความผิดพลาดที่เกิดจากการทำงานด้วยมือ
เพิ่มความเร็วในการพัฒนาและส่งมอบซอฟต์แวร์
ปรับปรุงคุณภาพของซอฟต์แวร์
ประเภทของเครื่องมืออัตโนมัติ:
แบ่งประเภทของเครื่องมือตามขั้นตอนต่างๆ ในวงจรชีวิตของ DevOps เช่น เครื่องมือสำหรับการสร้าง (Build), ทดสอบ (Test), ปรับใช้ (Deploy) และตรวจสอบ (Monitor)
ยกตัวอย่างเครื่องมือที่เป็นที่นิยม เช่น Jenkins, Docker, Kubernetes, Ansible เป็นต้น
สร้าง Pipeline อัตโนมัติ:
อธิบายแนวคิดของ CI/CD Pipeline
แสดงตัวอย่างของ Pipeline ที่ทำงานอัตโนมัติตั้งแต่การเขียนโค้ดจนถึงการปรับใช้บน Production</li>
<li>การส่งมอบซอฟต์แวร์ที่สม่ำเสมอ
Continuous Delivery และ Continuous Deployment:
อธิบายความแตกต่างระหว่าง CD และ CD
เน้นความสำคัญของการส่งมอบซอฟต์แวร์บ่อยครั้งและสม่ำเสมอ
การวัดผล:
กำหนดตัวชี้วัดสำคัญ (KPI) สำหรับวัดประสิทธิภาพของการส่งมอบซอฟต์แวร์ เช่น Lead time, Deployment frequency, Mean time to recovery (MTTR)
การจัดการความเสี่ยง:
อธิบายวิธีการจัดการความเสี่ยงในการส่งมอบซอฟต์แวร์บ่อยครั้ง เช่น การทำ A/B testing, Feature flags, Canary releases</li>
</ol>
<h2 id="เครืองมือทีเกียวของ"><a class="header" href="#เครืองมือทีเกียวของ">เครื่องมือที่เกี่ยวข้อง</a></h2>
<p>เครื่องมือที่ใช้ในการพัฒนา DevOps: สู่การทำงานที่รวดเร็วและมีประสิทธิภาพยิ่งขึ้น
DevOps เป็นแนวทางการทำงานที่เน้นความร่วมมือและการใช้เครื่องมืออัตโนมัติเพื่อเพิ่มประสิทธิภาพในการพัฒนาและส่งมอบซอฟต์แวร์ เครื่องมือที่ใช้ใน DevOps นั้นมีหลากหลายประเภท โดยแต่ละประเภทก็มีหน้าที่และจุดเด่นที่แตกต่างกันไป</p>
<h3 id="เครืองมือทีใชใน-devops-แบงออกไดเปนหลายประเภท-ดังนี"><a class="header" href="#เครืองมือทีใชใน-devops-แบงออกไดเปนหลายประเภท-ดังนี">เครื่องมือที่ใช้ใน DevOps แบ่งออกได้เป็นหลายประเภท ดังนี้</a></h3>
<ol>
<li><strong>เครื่องมือสำหรับการจัดการเวอร์ชัน (Version Control)Git:</strong><br />
เป็นเครื่องมือที่ได้รับความนิยมมากที่สุดสำหรับการจัดการเวอร์ชันของโค้ด ช่วยให้ทีมงานสามารถทำงานร่วมกันได้อย่างมีประสิทธิภาพ และติดตามการเปลี่ยนแปลงของโค้ดได้อย่างละเอียด</li>
<li><strong>เครื่องมือสำหรับการสร้าง (Build)Jenkins:</strong><br />
เป็นเครื่องมือสำหรับสร้างระบบอัตโนมัติที่ได้รับความนิยมอย่างแพร่หลาย สามารถใช้ในการสร้าง, ทดสอบ, และปรับใช้ซอฟต์แวร์ได้อย่างอัตโนมัติ
Maven, Gradle: เป็นเครื่องมือสำหรับจัดการโครงสร้างและการสร้างโปรเจคสำหรับภาษา Java</li>
<li><strong>เครื่องมือสำหรับการทดสอบ (Testing)</strong><br />
JUnit, TestNG: เป็นเครื่องมือสำหรับเขียนและรัน unit test สำหรับภาษา Java
Selenium: เป็นเครื่องมือสำหรับทดสอบเว็บแอปพลิเคชัน
Cucumber: เป็นเครื่องมือสำหรับเขียน test case ในรูปแบบที่เข้าใจง่าย โดยใช้ภาษาธรรมชาติ</li>
<li><strong>เครื่องมือสำหรับการปรับใช้ (Deployment)Docker:</strong><br />
เป็นแพลตฟอร์มสำหรับสร้างและจัดการคอนเทนเนอร์ ช่วยให้สามารถแพ็คแอปพลิเคชันและสิ่งแวดล้อมทั้งหมดไว้ในคอนเทนเนอร์เดียว และปรับใช้ได้บนเครื่องใดก็ได้
Kubernetes: เป็นแพลตฟอร์มสำหรับจัดการคอนเทนเนอร์ในระดับคลัสเตอร์ ช่วยให้สามารถปรับขนาดและจัดการแอปพลิเคชันที่ทำงานบนคอนเทนเนอร์ได้อย่างง่ายดาย
Ansible: เป็นเครื่องมือสำหรับจัดการโครงสร้างพื้นฐานแบบอัตโนมัติ ช่วยให้สามารถปรับใช้และกำหนดค่าเซิร์ฟเวอร์ได้อย่างรวดเร็ว</li>
<li><strong>เครื่องมือสำหรับการตรวจสอบ (Monitoring)Prometheus:</strong>   เป็นระบบสำหรับเก็บรวบรวมและวิเคราะห์ข้อมูลเมตริกต่างๆ ของระบบ
Grafana: เป็นเครื่องมือสำหรับสร้าง Dashboard เพื่อแสดงข้อมูลเมตริกที่ได้จาก Prometheus
ELK Stack: ประกอบด้วย Elasticsearch, Logstash, และ Kibana ใช้สำหรับเก็บและวิเคราะห์ log file</li>
<li><strong>เครื่องมือสำหรับการทำงานร่วมกัน (Collaboration)Jira, Trello:</strong>   เป็นเครื่องมือสำหรับการจัดการงานและติดตามความคืบหน้าของโครงการ
Slack, Microsoft Teams: เป็นเครื่องมือสำหรับการสื่อสารและทำงานร่วมกันเป็นทีม
การเลือกเครื่องมือที่เหมาะสม
การเลือกเครื่องมือที่เหมาะสมจะขึ้นอยู่กับขนาดของโครงการ, ความซับซ้อนของระบบ, และความต้องการของทีมงาน โดยควรพิจารณาถึงปัจจัยต่างๆ ดังนี้</li>
</ol>
<ul>
<li><strong>ความง่ายในการใช้งาน:</strong> เครื่องมือควรใช้งานง่ายและมีเอกสารประกอบที่ครบถ้วน</li>
<li><strong>ความยืดหยุ่น:</strong> เครื่องมือควรสามารถปรับเปลี่ยนและขยายได้ตามความต้องการ</li>
<li><strong>การสนับสนุน:</strong> เครื่องมือควรมีชุมชนผู้ใช้งานที่แข็งแกร่งและได้รับการสนับสนุนจากผู้พัฒนาอย่างต่อเนื่อง
สรุป</li>
</ul>
<h3 id="สรุปเครืองมือ-devops"><a class="header" href="#สรุปเครืองมือ-devops">สรุปเครื่องมือ DevOps</a></h3>
<p>มีความสำคัญอย่างยิ่งในการช่วยให้ทีมงานสามารถทำงานร่วมกันได้อย่างมีประสิทธิภาพ และส่งมอบซอฟต์แวร์ได้อย่างรวดเร็วและมีคุณภาพ การเลือกเครื่องมือที่เหมาะสมจะช่วยให้ทีมงานสามารถบรรลุเป้าหมายทางธุรกิจได้อย่างมีประสิทธิภาพมากยิ่งขึ้น</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="แนวคิด-cicd"><a class="header" href="#แนวคิด-cicd">แนวคิด CI/CD</a></h1>
<p>CI/CD ย่อมาจาก Continuous Integration และ Continuous Delivery (หรือ Continuous Deployment) เป็นชุดของแนวปฏิบัติและเครื่องมือในการพัฒนาซอฟต์แวร์ที่มุ่งเน้นการปรับปรุงกระบวนการสร้าง ทดสอบ และปล่อยแอปพลิเคชันให้ดีขึ้น รายละเอียดของแต่ละส่วนมีดังนี้:</p>
<h3 id="continuous-integration-ci"><a class="header" href="#continuous-integration-ci">Continuous Integration (CI)</a></h3>
<ul>
<li><strong>คำจำกัดความ</strong>: Continuous Integration คือการรวมโค้ดที่เปลี่ยนแปลงเข้าไปในที่เก็บรวมศูนย์หลายครั้งต่อวัน</li>
<li><strong>กระบวนการ</strong>:
<ol>
<li><strong>นักพัฒนารวมการเปลี่ยนแปลงโค้ดของตน</strong>: นักพัฒนารวมการเปลี่ยนแปลงโค้ดของตนเข้าไปในที่เก็บรวมศูนย์บ่อยๆ</li>
<li><strong>การสร้างและการทดสอบอัตโนมัติ</strong>: ทุกครั้งที่มีการรวมโค้ดจะมีการสร้างและทดสอบโดยอัตโนมัติเพื่อตรวจหาปัญหาตั้งแต่เนิ่นๆ</li>
<li><strong>ข้อเสนอแนะทันที</strong>: นักพัฒนาจะได้รับข้อเสนอแนะทันทีเกี่ยวกับคุณภาพและความถูกต้องของโค้ด</li>
</ol>
</li>
</ul>
<h3 id="continuous-delivery-cd"><a class="header" href="#continuous-delivery-cd">Continuous Delivery (CD)</a></h3>
<ul>
<li><strong>คำจำกัดความ</strong>: Continuous Delivery เป็นการขยายของ Continuous Integration ที่ทำให้แน่ใจว่าการเปลี่ยนแปลงโค้ดจะถูกเตรียมพร้อมสำหรับการปล่อยไปยังการใช้งานจริงโดยอัตโนมัติ</li>
<li><strong>กระบวนการ</strong>:
<ol>
<li><strong>การปล่อยอัตโนมัติ</strong>: เมื่อโค้ดผ่านการทดสอบทุกขั้นตอนแล้ว มันสามารถถูกปล่อยไปยังสภาพแวดล้อมการทดสอบได้</li>
<li><strong>การอนุมัติด้วยตนเอง</strong>: การปล่อยขั้นสุดท้ายไปยังการใช้งานจริงอาจต้องการการอนุมัติด้วยตนเองแต่พร้อมปล่อยได้ทุกเมื่อ</li>
<li><strong>ความสม่ำเสมอ</strong>: ทำให้มั่นใจว่าซอฟต์แวร์สามารถถูกปล่อยได้อย่างเชื่อถือได้ทุกเมื่อ</li>
</ol>
</li>
</ul>
<h3 id="continuous-deployment-cd"><a class="header" href="#continuous-deployment-cd">Continuous Deployment (CD)</a></h3>
<ul>
<li><strong>คำจำกัดความ</strong>: Continuous Deployment ไปไกลกว่า Continuous Delivery โดยการปล่อยทุกการเปลี่ยนแปลงที่ผ่านทุกขั้นตอนของท่อการผลิตไปยังการใช้งานจริงโดยอัตโนมัติ</li>
<li><strong>กระบวนการ</strong>:
<ol>
<li><strong>อัตโนมัติทั้งหมด</strong>: ไม่ต้องการการอนุมัติด้วยตนเอง ทำให้กระบวนการปล่อยเป็นอัตโนมัติทั้งหมด</li>
<li><strong>การปล่อยทันที</strong>: การเปลี่ยนแปลงโค้ดจะถูกปล่อยไปยังการใช้งานจริงทันทีที่ผ่านการทดสอบทั้งหมด</li>
</ol>
</li>
</ul>
<h3 id="ประโยชนของ-cicd"><a class="header" href="#ประโยชนของ-cicd">ประโยชน์ของ CI/CD</a></h3>
<ul>
<li><strong>การส่งมอบที่รวดเร็วขึ้น</strong>: เร่งกระบวนการปล่อยฟีเจอร์และการแก้ไขใหม่ๆ</li>
<li><strong>คุณภาพสูงขึ้น</strong>: การตรวจหาข้อบกพร่องและปัญหาตั้งแต่เนิ่นๆ ช่วยปรับปรุงคุณภาพของโค้ดโดยรวม</li>
<li><strong>การร่วมมือที่ดีขึ้น</strong>: ส่งเสริมการร่วมมือที่ดีขึ้นระหว่างสมาชิกทีมเพราะปัญหาการรวมถูกตรวจพบและแก้ไขตั้งแต่เนิ่นๆ</li>
<li><strong>ลดความเสี่ยง</strong>: การอัปเดตที่เล็กกว่าและบ่อยครั้งลดความเสี่ยงของปัญหาการปล่อยเมื่อเทียบกับการปล่อยขนาดใหญ่และไม่บ่อยครั้ง</li>
</ul>
<h3 id="เครืองมือและเทคโนโลยี"><a class="header" href="#เครืองมือและเทคโนโลยี">เครื่องมือและเทคโนโลยี</a></h3>
<ul>
<li><strong>เครื่องมือ CI</strong>: Jenkins, Travis CI, CircleCI, GitLab CI, Bamboo</li>
<li><strong>เครื่องมือ CD</strong>: Spinnaker, Argo CD, Tekton</li>
<li><strong>การควบคุมเวอร์ชัน</strong>: Git, Subversion</li>
<li><strong>การทำคอนเทนเนอร์</strong>: Docker, Kubernetes</li>
</ul>
<p>แนวปฏิบัติ CI/CD เป็นสิ่งสำคัญสำหรับการพัฒนาซอฟต์แวร์สมัยใหม่ ช่วยให้ทีมสามารถส่งมอบโค้ดได้อย่างเชื่อถือได้และมีประสิทธิภาพ</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ติดตัง-vagrant-tools-ใน-windows"><a class="header" href="#ติดตัง-vagrant-tools-ใน-windows">ติดตั้ง Vagrant Tools ใน windows</a></h1>
<p><img src="prepareration/../assets/images/vagrant_virtualbox.png" alt="" /></p>
<p>1 web vagrant <a href="https://www.vagrantup.com/">https://www.vagrantup.com/</a></p>
<h2 id="เนือหา-course-objective"><a class="header" href="#เนือหา-course-objective">เนื้อหา Course Objective</a></h2>
<ul>
<li>create virutal machine in Oracle Virtualbox by using Vagrant</li>
<li>Setup windows 11 to run Vagrant</li>
<li>Create Vagrantfile and setup paramenter of VM
<ul>
<li>Understand network configuration
<ul>
<li>NAT network</li>
<li>Private network</li>
<li>Public network</li>
</ul>
</li>
<li>File sync between Host and VM with package Rsync</li>
<li>Virtualization Customization
<ul>
<li>Customize number of CPU</li>
<li>Customize number of Memory</li>
<li>Customize Nested Virtualization</li>
</ul>
</li>
<li>Download image from Vagrant Cloud
<ul>
<li>Ubuntu image</li>
<li>Rocky image</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Vagrant เป็นเครื่องมือสำหรับการสร้างและจัดการสภาพแวดล้อมการพัฒนาซอฟต์แวร์แบบเสมือนจริง (virtualized development environments) มันช่วยให้นักพัฒนาซอฟต์แวร์สามารถสร้างและกำหนดค่าการพัฒนาได้อย่างง่ายดายและรวดเร็ว โดยไม่ต้องกังวลเกี่ยวกับความแตกต่างของสภาพแวดล้อมการพัฒนาระหว่างทีมงานหรือเครื่องต่างๆ</p>
<h3 id="คุณสมบัติของ-vagrant"><a class="header" href="#คุณสมบัติของ-vagrant">คุณสมบัติของ Vagrant</a></h3>
<ul>
<li><strong>การสร้างและจัดการ VM (Virtual Machines)</strong>: Vagrant ช่วยให้สามารถสร้างและจัดการเครื่องเสมือนบนหลายแพลตฟอร์มเช่น VirtualBox, VMware, AWS, Docker ฯลฯ</li>
<li><strong>การกำหนดค่าโดยใช้ไฟล์ Vagrantfile</strong>: นักพัฒนาสามารถกำหนดค่าการตั้งค่าเครื่องเสมือนผ่านไฟล์ Vagrantfile ซึ่งเป็นไฟล์ข้อความธรรมดาที่ระบุการตั้งค่าต่างๆ เช่น ระบบปฏิบัติการ ซอฟต์แวร์ที่ต้องติดตั้ง และการตั้งค่าเครือข่าย</li>
<li><strong>การแบ่งปันสภาพแวดล้อม</strong>: นักพัฒนาสามารถแบ่งปันสภาพแวดล้อมการพัฒนากับสมาชิกในทีมได้ง่ายๆ เพียงแค่แชร์ไฟล์ Vagrantfile ทำให้ทุกคนสามารถมีสภาพแวดล้อมการพัฒนาที่เหมือนกัน</li>
<li><strong>การจัดการโปรวิชั่น (Provisioning)</strong>: Vagrant รองรับการโปรวิชั่นโดยใช้เครื่องมือต่างๆ เช่น Shell scripts, Ansible, Chef, Puppet ทำให้นักพัฒนาสามารถติดตั้งและกำหนดค่าซอฟต์แวร์ในเครื่องเสมือนได้อย่างอัตโนมัติ</li>
</ul>
<h3 id="ประโยชนของ-vagrant"><a class="header" href="#ประโยชนของ-vagrant">ประโยชน์ของ Vagrant</a></h3>
<ul>
<li><strong>สภาพแวดล้อมที่สม่ำเสมอ</strong>: ลดปัญหาที่เกิดจากความแตกต่างของสภาพแวดล้อมการพัฒนา เช่น "works on my machine" ปัญหา</li>
<li><strong>การตั้งค่าที่รวดเร็วและง่ายดาย</strong>: ช่วยลดเวลาในการตั้งค่าสภาพแวดล้อมการพัฒนา</li>
<li><strong>การทำงานร่วมกันที่ดีขึ้น</strong>: ทำให้ทีมงานสามารถทำงานร่วมกันได้อย่างมีประสิทธิภาพมากขึ้นโดยไม่ต้องกังวลเกี่ยวกับสภาพแวดล้อมที่แตกต่างกัน</li>
<li><strong>การทดลองและทดสอบได้ง่าย</strong>: นักพัฒนาสามารถทดลองและทดสอบซอฟต์แวร์ในสภาพแวดล้อมที่ควบคุมได้</li>
</ul>
<h3 id="การใชงานเบืองตน"><a class="header" href="#การใชงานเบืองตน">การใช้งานเบื้องต้น</a></h3>
<ol>
<li><strong>ติดตั้ง Vagrant</strong>: ดาวน์โหลดและติดตั้ง Vagrant จาก <a href="https://www.vagrantup.com/">เว็บไซต์ Vagrant</a></li>
<li><strong>สร้างโปรเจคใหม่</strong>: สร้างไดเรกทอรีใหม่และรันคำสั่ง <code>vagrant init</code> เพื่อสร้างไฟล์ Vagrantfile</li>
<li><strong>กำหนดค่า Vagrantfile</strong>: แก้ไขไฟล์ Vagrantfile เพื่อกำหนดค่าการตั้งค่าต่างๆ ของเครื่องเสมือน</li>
<li><strong>เริ่มเครื่องเสมือน</strong>: รันคำสั่ง <code>vagrant up</code> เพื่อสร้างและเริ่มเครื่องเสมือน</li>
<li><strong>เชื่อมต่อกับเครื่องเสมือน</strong>: รันคำสั่ง <code>vagrant ssh</code> เพื่อเชื่อมต่อกับเครื่องเสมือนผ่าน SSH</li>
</ol>
<p>Vagrant เป็นเครื่องมือที่มีประโยชน์มากสำหรับนักพัฒนาซอฟต์แวร์ที่ต้องการสร้างและจัดการสภาพแวดล้อมการพัฒนาแบบเสมือนจริงอย่างมีประสิทธิภาพ</p>
<h2 id="step1-ปิดการทำงานของ-hyperv"><a class="header" href="#step1-ปิดการทำงานของ-hyperv">Step1 ปิดการทำงานของ HyperV</a></h2>
<p>Run Setup command in Powershell
Open Powershell with Adminstrator mode
Run:</p>
<pre><code>PS &gt; Disable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V-All
</code></pre>
<p>Run:</p>
<pre><code>PS &gt; bcdedit /set hypervisorlaunchtype off
</code></pre>
<p>Run:</p>
<pre><code>PS &gt; DISM /Online /Disable-Feature:Microsoft-Hyper-V
</code></pre>
<h2 id="step2-ติดตัง-rsync-ผานทาง-chocolatey"><a class="header" href="#step2-ติดตัง-rsync-ผานทาง-chocolatey">Step2 ติดตั้ง Rsync ผ่านทาง Chocolatey</a></h2>
<p>Chocolatey เป็นเครื่องมือสำหรับการจัดการแพ็คเกจ (package manager) บน Windows ซึ่งช่วยให้ผู้ใช้สามารถติดตั้ง อัปเดต และจัดการซอฟต์แวร์ได้ง่ายขึ้น มันทำงานคล้ายกับตัวจัดการแพ็คเกจบนระบบปฏิบัติการ Unix อย่าง apt บน Debian/Ubuntu หรือ yum บน CentOS/RHEL</p>
<h3 id="คุณสมบัติของ-chocolatey"><a class="header" href="#คุณสมบัติของ-chocolatey">คุณสมบัติของ Chocolatey</a></h3>
<ul>
<li><strong>การติดตั้งซอฟต์แวร์อย่างง่ายดาย</strong>: สามารถติดตั้งซอฟต์แวร์ต่างๆ ได้อย่างง่ายดายผ่านคำสั่งเดียว</li>
<li><strong>การจัดการการอัปเดต</strong>: สามารถอัปเดตซอฟต์แวร์ให้เป็นเวอร์ชันล่าสุดได้อย่างรวดเร็ว</li>
<li><strong>การลบซอฟต์แวร์</strong>: สามารถลบซอฟต์แวร์ที่ติดตั้งด้วย Chocolatey ได้อย่างง่ายดาย</li>
<li><strong>การจัดการแพ็คเกจ</strong>: รองรับการติดตั้งหลายแพ็คเกจพร้อมกัน การสร้างสคริปต์สำหรับการติดตั้งซอฟต์แวร์หลายๆ ตัว เป็นต้น</li>
</ul>
<p>ติดตั้ง chocolatey บน windows 11 <a href="https://chocolatey.org/install">https://chocolatey.org/install</a>  และทำตามคำแนะนำ
<img src="prepareration/../assets/images/windows_chocolatey.png" alt="" /></p>
<p>Run:</p>
<pre><code>&gt; Set-ExecutionPolicy Bypass -Scope Process

&gt; Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
</code></pre>
<p>Restart Windows Powershell</p>
<p><img src="prepareration/../assets/images/windows_chocolatey_cmd.png" alt="" /></p>
<p>Run: ติดตั้ง Rsync</p>
<pre><code>&gt; choco install rsync
</code></pre>
<h2 id="step3-ติดตัง-virtualbox-บน-windows"><a class="header" href="#step3-ติดตัง-virtualbox-บน-windows">Step3 ติดตั้ง virtualbox บน Windows</a></h2>
<ol>
<li>เปิด link <a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></li>
<li>Download  Virtualbox and Extension pack
<img src="prepareration/../assets/images/dowload_virtualbox.png" alt="" /></li>
</ol>
<div id="admonition-note" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-title">
<div class="admonition-title">
<div id="admonition-note-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="prepareration/setup_vagrant.html#admonition-note"></a>
</div>
<div>
<p>Choose virtualbox for your os</p>
</div>
</div>
<h2 id="step4-เพิม-cprogram-filesoraclevirtualbox-to-path-environment"><a class="header" href="#step4-เพิม-cprogram-filesoraclevirtualbox-to-path-environment">Step4 เพิ่ม C:\Program Files\Oracle\VirtualBox to path environment</a></h2>
<p>เพื่อให้สามารถใช้คำสั่งของ virtualbox ผ่าน Command line</p>
<ol>
<li>Press the Start key on your keyboard.</li>
<li>Search and open “Edit the system environment variables.”</li>
<li>Go to the “Advanced” tab.</li>
<li>Click the “Environment variables” button.</li>
<li>Select the “Path” variable under “User variables” or “System variables.”</li>
<li>Click the “Edit” button.</li>
<li>Press the “New” button.</li>
<li>Type the full directory path of the program.</li>
<li>Press “Enter” to confirm the path.</li>
<li>Click “Ok.”</li>
<li>Press the “Ok” button in the Environment Variables window.</li>
<li>Click “Ok” in the System Variables window.</li>
</ol>
<p><img src="prepareration/../assets/images/add_virtualbox_path.png" alt="" /></p>
<h2 id="step5-คิดคัง-install-vagrant"><a class="header" href="#step5-คิดคัง-install-vagrant">Step5 คิดคั้ง Install Vagrant</a></h2>
<ol>
<li>เปิด Link <a href="https://developer.hashicorp.com/vagrant/install">https://developer.hashicorp.com/vagrant/install</a></li>
</ol>
<p><img src="prepareration/../assets/images/vagrant_windows11.png" alt="" /></p>
<p>ตรวจสอบ ว่า มี C:\Program Files\Vagrant\bin อยู่ใน path ของ Windows หรือไม่
<img src="prepareration/../assets/images/vagrant_env.png" alt="" /></p>
<p>ทดสอบ command ใน Terminal</p>
<pre><code>C:\Users\sysadmin&gt;vagrant --version
Vagrant 2.4.1

C:\Users\sysadmin&gt;vagrant --help
Usage: vagrant [options] &lt;command&gt; [&lt;args&gt;]

    -h, --help                       Print this help.

Common commands:
     autocomplete    manages autocomplete installation on host
     box             manages boxes: installation, removal, etc.
     cloud           manages everything related to Vagrant Cloud
     destroy         stops and deletes all traces of the vagrant machine
     global-status   outputs status Vagrant environments for this user
     halt            stops the vagrant machine
     help            shows the help for a subcommand
     init            initializes a new Vagrant environment by creating a Vagrantfile
     login
     package         packages a running vagrant environment into a box
     plugin          manages plugins: install, uninstall, update, etc.
     port            displays information about guest port mappings
     powershell      connects to machine via powershell remoting
     provision       provisions the vagrant machine
     push            deploys code in this environment to a configured destination
     rdp             connects to machine via RDP
     reload          restarts vagrant machine, loads new Vagrantfile configuration
     resume          resume a suspended vagrant machine
     serve           start Vagrant server
     snapshot        manages snapshots: saving, restoring, etc.
     ssh             connects to machine via SSH
     ssh-config      outputs OpenSSH valid configuration to connect to the machine
     status          outputs status of the vagrant machine
     suspend         suspends the machine
     up              starts and provisions the vagrant environment
     upload          upload to machine via communicator
     validate        validates the Vagrantfile
     version         prints current and latest Vagrant version
     winrm           executes commands on a machine via WinRM
     winrm-config    outputs WinRM configuration to connect to the machine

For help on any individual command run `vagrant COMMAND -h`

Additional subcommands are available, but are either more advanced
or not commonly used. To see all subcommands, run the command
`vagrant list-commands`.
        --[no-]color                 Enable or disable color output
        --machine-readable           Enable machine readable output
    -v, --version                    Display Vagrant version
        --debug                      Enable debug output
        --timestamp                  Enable timestamps on log output
        --debug-timestamp            Enable debug output with timestamps
        --no-tty                     Enable non-interactive output

C:\Users\sysadmin&gt;
</code></pre>
<h3 id="step6-basic-vagrantfile"><a class="header" href="#step6-basic-vagrantfile">Step6 Basic Vagrantfile</a></h3>
<p>ให้สร้าง folder VagrantDev เพื่อใช้เป็น Project folder ก่อน</p>
<pre><code>C:\Users\sysadmin&gt; mkdir Vagrantdev
C:\Users\sysadmin&gt; cd Vagrantdev
C:\Users\sysadmin&gt; mkdir Centos9s
C:\Users\sysadmin&gt; cd Centos9s
C:\Users\sysadmin&gt; vagrant init generic/centos9s
C:\Users\sysadmin&gt; vagrant up
</code></pre>
<p><img src="prepareration/../assets/images/vagrant_screen.png" alt="" /></p>
<h3 id="ผลคำสัง"><a class="header" href="#ผลคำสัง">ผลคำสั่ง</a></h3>
<ol>
<li>vagrant init สร้าง file ชื่อ Vagrantfile</li>
<li>Vagrant up จะทำการ Download image จาก Vagrant Cloud <a href="https://app.vagrantup.com/boxes/search">https://app.vagrantup.com/boxes/search</a></li>
</ol>
<p><img src="prepareration/../assets/images/vagrant_cloud.png" alt="" /></p>
<h3 id="step7-download-image-แบบ-manual"><a class="header" href="#step7-download-image-แบบ-manual">Step7 Download image แบบ manual</a></h3>
<pre><code>C:\Users\sysadmin&gt; vagrant box add generic/ubuntu2310
</code></pre>
<p>เลือก ชนิด Hypervisor เป็น Virtualbox (หมายเลข 5)</p>
<p><img src="prepareration/../assets/images/vagrant_box_add_ubuntu.png" alt="" /></p>
<h2 id="step-8-สรุปคำสังพืนฐานของ-vagrant"><a class="header" href="#step-8-สรุปคำสังพืนฐานของ-vagrant">Step 8 สรุปคำสั่งพื้นฐานของ Vagrant</a></h2>
<h3 id="คำสัง-download-vagrant-box"><a class="header" href="#คำสัง-download-vagrant-box">คำสั่ง Download Vagrant box</a></h3>
<ul>
<li><code>vagrant box add &lt;image-name&gt;</code>
<ul>
<li>แทน image-name ด้วยชื่อของ image เช่น <code>generic/centos9s</code></li>
</ul>
</li>
</ul>
<h3 id="การตังคาและการจัดการเครืองเสมือน"><a class="header" href="#การตังคาและการจัดการเครืองเสมือน">การตั้งค่าและการจัดการเครื่องเสมือน</a></h3>
<ul>
<li><code>vagrant init</code>
<ul>
<li>สร้างไฟล์ <code>Vagrantfile</code> ในไดเรกทอรีปัจจุบัน</li>
</ul>
</li>
<li><code>vagrant up</code> หรือ <code>vagrant up --provider=virtualbox</code>
<ul>
<li>สร้างและเริ่มเครื่องเสมือนตามการตั้งค่าใน <code>Vagrantfile</code></li>
</ul>
</li>
<li><code>vagrant ssh</code>
<ul>
<li>เชื่อมต่อกับเครื่องเสมือนผ่าน SSH</li>
</ul>
</li>
<li><code>vagrant halt</code>
<ul>
<li>ปิดเครื่องเสมือน</li>
</ul>
</li>
<li><code>vagrant destroy</code>
<ul>
<li>ลบเครื่องเสมือน</li>
</ul>
</li>
</ul>
<h2 id="การจัดการการตังคาและการโปรวิชัน"><a class="header" href="#การจัดการการตังคาและการโปรวิชัน">การจัดการการตั้งค่าและการโปรวิชั่น</a></h2>
<ul>
<li><code>vagrant reload</code>
<ul>
<li>รีสตาร์ทเครื่องเสมือนและโหลดการตั้งค่าใหม่จาก <code>Vagrantfile</code> แต่ไม่ Run provision</li>
</ul>
</li>
<li><code>vagrant reload --provision</code>
<ul>
<li>Force ให้ Run provision ด้วย ขณะที่มีการ Reload</li>
</ul>
</li>
<li><code>vagrant provision</code>
<ul>
<li>รันโปรวิชั่นเนอร์ที่กำหนดไว้ใน <code>Vagrantfile</code></li>
</ul>
</li>
</ul>
<h2 id="การตรวจสอบสถานะและขอมูลเครืองเสมือน"><a class="header" href="#การตรวจสอบสถานะและขอมูลเครืองเสมือน">การตรวจสอบสถานะและข้อมูลเครื่องเสมือน</a></h2>
<ul>
<li><code>vagrant status</code>
<ul>
<li>แสดงสถานะปัจจุบันของเครื่องเสมือน</li>
</ul>
</li>
<li><code>vagrant global-status</code>
<ul>
<li>แสดงสถานะของเครื่องเสมือนทั้งหมดที่จัดการโดย Vagrant บนเครื่องคอมพิวเตอร์นั้นๆ</li>
</ul>
</li>
<li><code>vagrant ssh-config</code>
<ul>
<li>แสดงการตั้งค่า SSH สำหรับเชื่อมต่อกับเครื่องเสมือน</li>
</ul>
</li>
</ul>
<h2 id="การจัดการสแนปชอต"><a class="header" href="#การจัดการสแนปชอต">การจัดการสแน็ปช็อต</a></h2>
<ul>
<li><code>vagrant snapshot save [ชื่อสแน็ปช็อต]</code>
<ul>
<li>บันทึกสถานะปัจจุบันของเครื่องเสมือนเป็นสแน็ปช็อต</li>
</ul>
</li>
<li><code>vagrant snapshot restore [ชื่อสแน็ปช็อต]</code>
<ul>
<li>กู้คืนสถานะเครื่องเสมือนจากสแน็ปช็อตที่บันทึกไว้</li>
</ul>
</li>
<li><code>vagrant snapshot list</code>
<ul>
<li>แสดงรายการสแน็ปช็อตทั้งหมดของเครื่องเสมือน</li>
</ul>
</li>
<li><code>vagrant snapshot delete [ชื่อสแน็ปช็อต]</code>
<ul>
<li>ลบสแน็ปช็อตที่ระบุ</li>
</ul>
</li>
</ul>
<h2 id="การซิงคไฟลและโฟลเดอร"><a class="header" href="#การซิงคไฟลและโฟลเดอร">การซิงค์ไฟล์และโฟลเดอร์</a></h2>
<ul>
<li><code>vagrant rsync</code>
<ul>
<li>ซิงค์ไฟล์จากโฮสต์ไปยังเครื่องเสมือนด้วย rsync</li>
</ul>
</li>
<li><code>vagrant rsync-auto</code>
<ul>
<li>ซิงค์ไฟล์จากโฮสต์ไปยังเครื่องเสมือนโดยอัตโนมัติเมื่อมีการเปลี่ยนแปลงไฟล์</li>
</ul>
</li>
</ul>
<p>การใช้คำสั่งเหล่านี้ช่วยให้คุณสามารถจัดการเครื่องเสมือนได้อย่างง่ายดายและมีประสิทธิภาพในกระบวนการพัฒนาซอฟต์แวร์</p>
<h3 id="run-vagrant-provisioning"><a class="header" href="#run-vagrant-provisioning">Run Vagrant provisioning</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vagrant-workshop-single-node-lamp-stack"><a class="header" href="#vagrant-workshop-single-node-lamp-stack">Vagrant Workshop: Single Node LAMP Stack</a></h1>
<h2 id="วัตถุประสงค"><a class="header" href="#วัตถุประสงค">วัตถุประสงค์</a></h2>
<p>เรียนรู้วิธีการสร้างและจัดการสภาพแวดล้อม LAMP (Linux, Apache, MySQL, PHP) บน VM(VM) โดยใช้ Vagrant</p>
<h2 id="ขันตอนการสราง-single-node-lamp-stack-ดวย-vagrant"><a class="header" href="#ขันตอนการสราง-single-node-lamp-stack-ดวย-vagrant">ขั้นตอนการสร้าง Single Node LAMP Stack ด้วย Vagrant</a></h2>
<h3 id="1-การตังคาโปรเจค"><a class="header" href="#1-การตังคาโปรเจค">1. การตั้งค่าโปรเจค</a></h3>
<ol>
<li>เปิดเทอร์มินัลหรือ PowerShell</li>
<li>สร้างไดเรกทอรีใหม่สำหรับโปรเจค
<pre><code class="language-sh">mkdir vagrant-lamp
cd vagrant-lamp
</code></pre>
</li>
<li>รันคำสั่ง <code>vagrant init</code> เพื่อสร้างไฟล์ <code>Vagrantfile</code>
<pre><code class="language-sh">vagrant init generic/ubuntu2304
</code></pre>
</li>
</ol>
<h3 id="2-การกำหนดคา-vagrantfile"><a class="header" href="#2-การกำหนดคา-vagrantfile">2. การกำหนดค่า Vagrantfile</a></h3>
<p>เปิดไฟล์ <code>Vagrantfile</code> และแก้ไขดังนี้:</p>
<pre><code class="language-ruby">Vagrant.configure("2") do |config|
  # เลือก box ที่จะใช้
  config.vm.box = "generic/ubuntu2304"

  # กำหนด hostname
  config.vm.hostname = "lamp-stack"

  # การตั้งค่าเครือข่าย
  config.vm.network "private_network", ip: "192.168.33.10"
  config.vm.network "forwarded_port", guest: 80, host: 8080
  # การติดตั้ง Apache, MySQL, PHP
  config.vm.provision "shell", inline: &lt;&lt;-SHELL
    apt-get update
    apt-get install -y apache2
    apt-get install -y mysql-server
    apt-get install -y php libapache2-mod-php php-mysql
    systemctl enable apache2
    systemctl start apache2
  SHELL
end
</code></pre>
<h3 id="3-การเริมตน-vm"><a class="header" href="#3-การเริมตน-vm">3. การเริ่มต้น VM</a></h3>
<p>รันคำสั่ง vagrant up เพื่อสร้างและเริ่มต้นเครื่องเสมือน</p>
<pre><code>vagrant up --provider=virtualbox --provision
</code></pre>
<p><img src="prepareration/../assets/images/vagrant_lamp_install.png" alt="" /></p>
<p>ตรวจสอบ ssh-config</p>
<pre><code>vagrant ssh-config
</code></pre>
<p><img src="prepareration/../assets/images/vagrant_lamp_ssh.png" alt="" /></p>
<p>รันคำสั่ง vagrant ssh เพื่อเชื่อมต่อกับเครื่องเสมือนผ่าน SSH</p>
<pre><code>vagrant ssh
</code></pre>
<p><img src="prepareration/../assets/images/vagrant_ssh_lamp.png" alt="" /></p>
<h3 id="การใชคำสัง-lsof"><a class="header" href="#การใชคำสัง-lsof">การใช้คำสั่ง lsof</a></h3>
<div id="admonition-note" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-title">
<div class="admonition-title">
<div id="admonition-note-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="prepareration/vagrant_workshop.html#admonition-note"></a>
</div>
<div>
<p>The lsof command, in combination with other tools like top or ps, can be very helpful when diagnosing network issue.</p>
<p>$ sudo lsof -i TCP:22</p>
</div>
</div>
<p>คำอธิบายแต่ละ Colume:</p>
<ul>
<li><strong>COMMAND:</strong> The command name</li>
<li><strong>PID:</strong> Process ID (PID) of the process</li>
<li><strong>USER:</strong> Owner of the process</li>
<li><strong>FD:</strong> File descriptor definition</li>
<li><strong>TYPE:</strong> Type of file descriptor</li>
<li><strong>DEVICE:</strong> Device number or, in the case of a block device, character or other</li>
<li><strong>SIZE/OFF:</strong> Dimension of the file or offset (the suffix <code>0t</code> is the offset)</li>
<li><strong>NODE:</strong> Node description of the local file; this could be the number of the local file, TCP, UDP, or STR (stream)</li>
<li><strong>NAME:</strong> The name of the mount point where the file resides</li>
</ul>
<pre><code>$ sudo lsof -i TCP:22
</code></pre>
<p><img src="prepareration/../assets/images/vagrant_lamp_net.png" alt="" /></p>
<h3 id="4-การทดสอบ-apache"><a class="header" href="#4-การทดสอบ-apache">4. การทดสอบ Apache</a></h3>
<p>เปิดเว็บเบราว์เซอร์และเข้าไปที่ http://localhost:8080 หากทุกอย่างถูกตั้งค่าอย่างถูกต้อง คุณควรเห็นหน้าเริ่มต้นของ Apache</p>
<p><img src="prepareration/../assets/images/vagrant_lamp.png" alt="" /></p>
<h3 id="5-การทดสอบ-php"><a class="header" href="#5-การทดสอบ-php">5. การทดสอบ PHP</a></h3>
<p>สร้างไฟล์ PHP เพื่อทดสอบการทำงานของ PHP</p>
<pre><code>$ sudo su -
# echo "&lt;?php phpinfo(); ?&gt;" &gt; /var/www/html/info.php
</code></pre>
<p><img src="prepareration/../assets/images/vagrant_ssh_php_config.png" alt="" /></p>
<p>เปิดเว็บเบราว์เซอร์และเข้าไปที่ http://localhost:8080/info.php ควรเห็นหน้าแสดงข้อมูล PHP</p>
<p><img src="prepareration/../assets/images/vagrant_lamp_php.png" alt="" /></p>
<h3 id="6-การทดสอบ-mysql"><a class="header" href="#6-การทดสอบ-mysql">6. การทดสอบ MySQL</a></h3>
<p>เชื่อมต่อกับ MySQL โดยใช้คำสั่งต่อไปนี้:
โดยให้เปลี่ยน เป็น user root ก่อน</p>
<pre><code>$ sudo su -
# mysql -u root -p
</code></pre>
<p>ค่าเริ่มต้นจะเป็นค่าว่าง กด Enter เพื่อเข้าสู่ MySQL shell
รันคำสั่งต่อไปนี้เพื่อสร้างฐานข้อมูลทดสอบ:</p>
<pre><code class="language-sql">CREATE DATABASE testdb;
SHOW DATABASES;
</code></pre>
<p><img src="prepareration/../assets/images/vagrant_lamp_database.png" alt="" /></p>
<h3 id="7การจัดการเครืองเสมือน"><a class="header" href="#7การจัดการเครืองเสมือน">7.การจัดการเครื่องเสมือน</a></h3>
<p>ปิด VM</p>
<pre><code>vagrant halt
</code></pre>
<p>ลบ VM</p>
<pre><code>vagrant destroy
</code></pre>
<h3 id="สรุป"><a class="header" href="#สรุป">สรุป</a></h3>
<p>การใช้ Vagrant สำหรับการตั้งค่า LAMP stack จะช่วยให้คุณสามารถสร้างสภาพแวดล้อมการพัฒนาที่สม่ำเสมอและสามารถทำซ้ำได้ง่ายดาย เมื่อคุณมี Vagrantfile คุณสามารถแบ่งปันไฟล์นี้กับทีมของคุณเพื่อให้ทุกคนสามารถใช้สภาพแวดล้อมการพัฒนาเดียวกันได้</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vagrant-workshop-docker-host"><a class="header" href="#vagrant-workshop-docker-host">vagrant workshop: Docker host</a></h1>
<h2 id="วัตถุประสงค-1"><a class="header" href="#วัตถุประสงค-1">วัตถุประสงค์</a></h2>
<p>เรียนรู้วิธีการสร้าง Docker host สำหรับการเรียนรู้ Container</p>
<h2 id="ขันตอนการสราง-single-node-lamp-stack-ดวย-vagrant-1"><a class="header" href="#ขันตอนการสราง-single-node-lamp-stack-ดวย-vagrant-1">ขั้นตอนการสร้าง Single Node LAMP Stack ด้วย Vagrant</a></h2>
<h3 id="1-การตังคาโปรเจค-1"><a class="header" href="#1-การตังคาโปรเจค-1">1. การตั้งค่าโปรเจค</a></h3>
<ol>
<li>เปิดเทอร์มินัลหรือ PowerShell</li>
<li>สร้างไดเรกทอรีใหม่สำหรับโปรเจค
<pre><code class="language-sh">mkdir vagrant-docker
cd vagrant-docker
</code></pre>
</li>
<li>รันคำสั่ง <code>vagrant init</code> เพื่อสร้างไฟล์ <code>Vagrantfile</code>
<pre><code class="language-sh">vagrant init generic/ubuntu2304
</code></pre>
</li>
</ol>
<h3 id="2-การกำหนดคา-vagrantfile-1"><a class="header" href="#2-การกำหนดคา-vagrantfile-1">2. การกำหนดค่า Vagrantfile</a></h3>
<p>เปิดไฟล์ <code>Vagrantfile</code> และแก้ไขดังนี้:</p>
<pre><code class="language-ruby"># -*- mode: ruby -*-
# vi: set ft=ruby :

# All Vagrant configuration is done below. The "2" in Vagrant.configure
# configures the configuration version (we support older styles for
# backwards compatibility). Please don't change it unless you know what
# you're doing.

$script = &lt;&lt;-SCRIPT

  # ติดตั้ง packages
  sudo apt install apt-transport-https ca-certificates curl software-properties-common -y
  
  # ติดตั้ง Docker official GPG key
  curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

  # ติดตั้ง Repository
  sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" -y
  sudo apt-cache policy docker-ce 

  # ติดตั้ง Docker
  sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin -y 
  sudo usermod -aG docker vagrant 

  # เริ่มต้น Docker service
  sudo systemctl enable --now docker
 
SCRIPT
Vagrant.configure("2") do |config|
  config.vm.box = "generic/ubuntu2304"
  config.vm.network "private_network", ip: "192.168.33.10"
  config.vm.synced_folder ".", "/vagrant", type: 'rsync'

  
  config.vm.provider "virtualbox" do |vb|
    vb.cpus = 2
    vb.memory = 2048
  end

  config.vm.provision "shell" , inline: $script
end


</code></pre>
<h3 id="3-การเริมตน-vm-1"><a class="header" href="#3-การเริมตน-vm-1">3. การเริ่มต้น VM</a></h3>
<p>รันคำสั่ง vagrant up เพื่อสร้างและเริ่มต้นเครื่องเสมือน</p>
<pre><code>vagrant up --provider=virtualbox --provision
</code></pre>
<h3 id="4-รันคำสัง-vagrant-ssh-เพือเชือมตอกับเครืองเสมือนผาน-ssh"><a class="header" href="#4-รันคำสัง-vagrant-ssh-เพือเชือมตอกับเครืองเสมือนผาน-ssh">4. รันคำสั่ง vagrant ssh เพื่อเชื่อมต่อกับเครื่องเสมือนผ่าน SSH</a></h3>
<pre><code>vagrant ssh
</code></pre>
<h3 id="5-ทดสอบคำสัง-docker-ps"><a class="header" href="#5-ทดสอบคำสัง-docker-ps">5. ทดสอบคำสั่ง <code>docker ps</code></a></h3>
<pre><code>vagrant@ubuntu2304:~$ docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</code></pre>
<h3 id="6-ทดสอบเลือก-pull-image-จาก-docker-hub-httpshubdockercomsearchimage_filterofficial"><a class="header" href="#6-ทดสอบเลือก-pull-image-จาก-docker-hub-httpshubdockercomsearchimage_filterofficial">6. ทดสอบเลือก pull image จาก docker hub <a href="https://hub.docker.com/search?image_filter=official">https://hub.docker.com/search?image_filter=official</a></a></h3>
<pre><code>vagrant@ubuntu2304:~$ docker pull python
Using default tag: latest
latest: Pulling from library/python
ca4e5d672725: Pull complete
30b93c12a9c9: Pull complete
10d643a5fa82: Pull complete
d6dc1019d793: Pull complete
5afcd2745721: Pull complete
b5dbe4a95907: Pull complete
26b10780b7b0: Pull complete
d2f126f49360: Pull complete
Digest: sha256:e8be0ea148390d08bc077840cf87ac6a538d80b0ea1e8752b3e3982987cd0a53
Status: Downloaded newer image for python:latest
docker.io/library/python:latest
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="แนะนำ-ansible"><a class="header" href="#แนะนำ-ansible">แนะนำ Ansible</a></h1>
<h1 id="ansible-คืออะไร"><a class="header" href="#ansible-คืออะไร">Ansible คืออะไร</a></h1>
<p>Ansible เป็นเครื่องมือที่ใช้ในการจัดการและการตั้งค่าโครงสร้างพื้นฐาน (Infrastructure) แบบอัตโนมัติ โดยมุ่งเน้นที่ความง่ายในการใช้งานและการตั้งค่า รวมถึงสามารถจัดการระบบในลักษณะต่าง ๆ เช่น การตั้งค่าเซิร์ฟเวอร์, การติดตั้งซอฟต์แวร์, และการจัดการคอนฟิกูเรชัน</p>
<p><img src="module1/../assets/images/ansible-docs.png" alt="" /></p>
<h2 id="คุณสมบัติหลักของ-ansible"><a class="header" href="#คุณสมบัติหลักของ-ansible">คุณสมบัติหลักของ Ansible</a></h2>
<ol>
<li>
<p><strong>การตั้งค่าและการจัดการโครงสร้างพื้นฐาน:</strong> Ansible ใช้เพื่อจัดการโครงสร้างพื้นฐานทั้งในระดับเซิร์ฟเวอร์และแอปพลิเคชันอย่างมีประสิทธิภาพ โดยไม่ต้องใช้โค้ดที่ซับซ้อน</p>
</li>
<li>
<p><strong>ไม่ต้องติดตั้ง Agent:</strong> Ansible ใช้การเชื่อมต่อ SSH (สำหรับระบบ Unix/Linux) หรือ WinRM (สำหรับ Windows) เพื่อทำการจัดการโฮสต์ โดยไม่ต้องติดตั้งโปรแกรมหรือ Agent เพิ่มเติมบนโฮสต์เป้าหมาย</p>
</li>
<li>
<p><strong>การใช้ YAML:</strong> Ansible ใช้ YAML (YAML Ain't Markup Language) สำหรับการเขียน Playbooks ซึ่งเป็นไฟล์ที่ประกอบด้วยคำสั่งในการตั้งค่าและการจัดการโครงสร้างพื้นฐาน ซึ่งทำให้การอ่านและเขียนโค้ดทำได้ง่าย</p>
</li>
<li>
<p><strong>ความสามารถในการจัดการหลายโฮสต์พร้อมกัน:</strong> Ansible สามารถจัดการหลายโฮสต์พร้อมกันจากจุดเดียว ทำให้การดำเนินการในสภาพแวดล้อมขนาดใหญ่มีประสิทธิภาพมากขึ้น</p>
</li>
<li>
<p><strong>การจัดการความลับและการเข้ารหัส:</strong> Ansible Vault ช่วยให้สามารถจัดการข้อมูลลับ เช่น รหัสผ่าน หรือคีย์การเข้าถึง ได้อย่างปลอดภัย</p>
</li>
<li>
<p><strong>การใช้งานง่าย:</strong> Ansible มีโครงสร้างที่เรียบง่ายและใช้งานง่าย ซึ่งช่วยลดความซับซ้อนในการจัดการโครงสร้างพื้นฐาน</p>
</li>
</ol>
<h2 id="แนวทางการทำงานของ-ansible"><a class="header" href="#แนวทางการทำงานของ-ansible">แนวทางการทำงานของ Ansible</a></h2>
<ol>
<li>
<p><strong>การเชื่อมต่อ:</strong> Ansible เชื่อมต่อกับโฮสต์เป้าหมายผ่าน SSH หรือ WinRM</p>
</li>
<li>
<p><strong>การรัน Playbooks:</strong> Ansible รันคำสั่งที่ระบุในไฟล์ Playbook ที่เขียนด้วย YAML</p>
</li>
<li>
<p><strong>การตรวจสอบและรายงานผล:</strong> Ansible ตรวจสอบผลลัพธ์และรายงานสถานะการดำเนินการ</p>
</li>
</ol>
<h2 id="ตัวอยางการใชงาน"><a class="header" href="#ตัวอยางการใชงาน">ตัวอย่างการใช้งาน</a></h2>
<ul>
<li><strong>การตั้งค่าเซิร์ฟเวอร์เว็บ:</strong> ติดตั้งและตั้งค่าเซิร์ฟเวอร์เว็บ เช่น Apache หรือ Nginx</li>
<li><strong>การจัดการแพ็กเกจ:</strong> ติดตั้งหรืออัพเดตซอฟต์แวร์</li>
<li><strong>การจัดการคอนฟิกูเรชัน:</strong> ปรับแต่งการตั้งค่าต่าง ๆ ของระบบและแอปพลิเคชัน</li>
</ul>
<h2 id="ตัวอยาง-playbook"><a class="header" href="#ตัวอยาง-playbook">ตัวอย่าง Playbook</a></h2>
<p>นี่คือตัวอย่างของไฟล์ Playbook ที่ใช้ในการติดตั้ง Nginx บนเซิร์ฟเวอร์:</p>
<pre><code class="language-yaml">- name: Install and start Nginx
  hosts: webservers
  become: yes
  tasks:
    - name: Install Nginx
      apt:
        name: nginx
        state: present

    - name: Start Nginx service
      service:
        name: nginx
        state: started

</code></pre>
<h1 id="ansible-engine"><a class="header" href="#ansible-engine">Ansible Engine</a></h1>
<p><strong>Ansible Engine</strong> คือส่วนหลักของ Ansible ที่ใช้ในการทำงานหลักในการจัดการและการตั้งค่าโครงสร้างพื้นฐาน (Infrastructure) แบบอัตโนมัติ มันเป็นเครื่องมือที่ใช้ในการควบคุมการทำงานของโฮสต์หลาย ๆ เครื่องจากจุดเดียวโดยไม่ต้องติดตั้งโปรแกรมหรือ agent เพิ่มเติมบนโฮสต์เป้าหมาย</p>
<h2 id="คุณสมบัติหลักของ-ansible-engine"><a class="header" href="#คุณสมบัติหลักของ-ansible-engine">คุณสมบัติหลักของ Ansible Engine</a></h2>
<ol>
<li>
<p><strong>การควบคุมการทำงานจากจุดเดียว:</strong> Ansible Engine ช่วยให้ผู้ใช้สามารถควบคุมการทำงานและการตั้งค่าหลาย ๆ โฮสต์จากจุดเดียวผ่านไฟล์ Playbook และคำสั่ง ad-hoc</p>
</li>
<li>
<p><strong>การใช้ YAML สำหรับ Playbooks:</strong> ใช้ YAML (YAML Ain't Markup Language) ในการเขียน Playbooks ซึ่งเป็นไฟล์ที่กำหนดงานที่ต้องการให้ Ansible ทำ โดย Playbooks จะประกอบด้วยชุดของคำสั่งที่เรียงลำดับในการดำเนินการ</p>
</li>
<li>
<p><strong>การจัดการโฮสต์ผ่าน SSH หรือ WinRM:</strong> Ansible Engine เชื่อมต่อกับโฮสต์เป้าหมายผ่าน SSH (สำหรับระบบ Unix/Linux) หรือ WinRM (สำหรับ Windows) โดยไม่ต้องติดตั้ง agent บนโฮสต์</p>
</li>
<li>
<p><strong>การทำงานแบบ Idempotent:</strong> Ansible Engine ทำงานโดยมีลักษณะ idempotent หมายความว่าการรันคำสั่งเดียวกันหลายครั้งจะให้ผลลัพธ์เหมือนกันเสมอ โดยไม่ทำให้เกิดการเปลี่ยนแปลงที่ไม่จำเป็น</p>
</li>
<li>
<p><strong>การจัดการกับหลายโฮสต์พร้อมกัน:</strong> Ansible Engine สามารถจัดการกับหลายโฮสต์พร้อมกันจากจุดเดียว โดยใช้การจัดกลุ่มโฮสต์และการจัดการงานแบบขนาน</p>
</li>
<li>
<p><strong>การจัดการความลับด้วย Ansible Vault:</strong> Ansible Engine ใช้ Ansible Vault สำหรับการเข้ารหัสข้อมูลลับ เช่น รหัสผ่าน หรือคีย์การเข้าถึง เพื่อให้แน่ใจว่าข้อมูลสำคัญจะถูกจัดเก็บอย่างปลอดภัย</p>
</li>
</ol>
<h2 id="สวนประกอบหลักของ-ansible-engine"><a class="header" href="#สวนประกอบหลักของ-ansible-engine">ส่วนประกอบหลักของ Ansible Engine</a></h2>
<ol>
<li>
<p><strong>Playbooks:</strong> ไฟล์ที่เขียนด้วย YAML ซึ่งกำหนดชุดของงานที่ Ansible จะทำบนโฮสต์เป้าหมาย</p>
</li>
<li>
<p><strong>Inventories:</strong> ไฟล์ที่ระบุรายการโฮสต์และกลุ่มของโฮสต์ที่ Ansible จะจัดการ</p>
</li>
<li>
<p><strong>Modules:</strong> ชุดของฟังก์ชันที่ใช้ในการดำเนินการต่าง ๆ บนโฮสต์ เช่น การติดตั้งซอฟต์แวร์หรือการคัดลอกไฟล์</p>
</li>
<li>
<p><strong>Roles:</strong> การจัดกลุ่มของ tasks, handlers, และตัวแปรที่สามารถนำมาใช้ซ้ำได้ใน Playbooks</p>
</li>
<li>
<p><strong>Handlers:</strong> คำสั่งพิเศษที่ถูกเรียกใช้เมื่อมีการเปลี่ยนแปลงที่ระบุไว้ใน Playbook</p>
</li>
<li>
<p><strong>Variables:</strong> ตัวแปรที่ใช้ในการกำหนดค่าต่าง ๆ ภายใน Playbooks เพื่อให้สามารถปรับเปลี่ยนได้ตามต้องการ</p>
</li>
</ol>
<h2 id="การใชงาน-ansible-engine"><a class="header" href="#การใชงาน-ansible-engine">การใช้งาน Ansible Engine</a></h2>
<p><img src="module1/../assets/images/ansible-a-engine.jpg" alt="" /></p>
<p>การใช้งาน Ansible Engine มักจะรวมถึงการสร้างและรัน Playbooks เพื่อทำการตั้งค่าและจัดการโครงสร้างพื้นฐาน ซึ่งสามารถทำได้ผ่านบรรทัดคำสั่งหรือจากเครื่องมือการจัดการอื่น ๆ ที่รองรับ Ansible</p>
<p>Ansible Engine เป็นเครื่องมือที่มีความสามารถสูงและยืดหยุ่นในการจัดการโครงสร้างพื้นฐาน IT ช่วยให้การทำงานในสภาพแวดล้อมขนาดใหญ่และซับซ้อนได้อย่างมีประสิทธิภาพ</p>
<h2 id="การทดสอบการตังคา"><a class="header" href="#การทดสอบการตังคา">การทดสอบการตั้งค่า</a></h2>
<p>สามารถตรวจสอบการตั้งค่า Ansible ด้วยการใช้คำสั่ง</p>
<pre><code>$ ansible --version
ansible [core 2.14.17]
  config file = /etc/ansible/ansible.cfg
  configured module search path = ['/home/vagrant/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/lib/python3.9/site-packages/ansible
  ansible collection location = /home/vagrant/.ansible/collections:/usr/share/ansible/collections
  executable location = /usr/bin/ansible
  python version = 3.9.18 (main, Sep  7 2023, 00:00:00) [GCC 11.4.1 20230605 (Red Hat 11.4.1-2)] (/usr/bin/python3)
  jinja version = 3.1.2
  libyaml = True
</code></pre>
<h2 id="inventory"><a class="header" href="#inventory">Inventory</a></h2>
<p>เมื่อเริ่มใช้งาน Ansible (ไม่นับขั้นตอนการติดตั้ง) สิ่งแรกที่เราต้องมีคือไฟล์ <strong>inventory</strong> ที่จะช่วยให้ Ansible รู้ว่าเรากำลังจะจัดการกับเครื่องไหนบ้าง ไฟล์ inventory มีโครงสร้างที่ง่ายที่สุดในรูปแบบของไฟล์  ดังนี้:</p>
<pre><code>[groupname]
host1
host2
</code></pre>
<ul>
<li><strong>ตัวอย่าง</strong></li>
</ul>
<pre><code>[db-servers]
db-01  ansible_host=192.168.124.243
db-02  ansible_host=192.168.124.182

[web-servers]
web-01  ansible_host=192.168.124.158
web-02  ansible_host=192.168.124.153
web-03  ansible_host=192.168.124.92
</code></pre>
<ul>
<li>save ไฟล์นี้ในชื่อไฟล์ว่า hosts</li>
</ul>
<h2 id="การใชไฟล-inventory-ทดสอบ-connectivity"><a class="header" href="#การใชไฟล-inventory-ทดสอบ-connectivity">การใช้ไฟล์ Inventory ทดสอบ connectivity</a></h2>
<p>เมื่อมีไฟล์ inventory แล้ว คุณสามารถเรียกใช้ Ansible โดยระบุไฟล์ inventory ได้ด้วยการเพิ่มพารามิเตอร์ <code>-i hosts</code> (แทนที่ hosts ด้วยชื่อไฟล์ inventory ที่คุณสร้างขึ้น) ในคำสั่ง ansible หรือ ansible-playbook:</p>
<pre><code>ansible -i hosts -m ping all
</code></pre>
<p>นอกจากนี้ คุณยังสามารถตั้งค่าให้ Ansible ใช้ไฟล์ inventory นี้โดยอัตโนมัติด้วยการสร้างไฟล์ ansible.cfg ในโฟลเดอร์เดียวกัน แล้วใส่ข้อความดังนี้:</p>
<pre><code>[defaults]
inventory = hosts
remote_user = ubuntu
private_key_file = keys/ansibleSSH.pem
host_key_checking = False
</code></pre>
<h2 id="กำหนด-ssh-สำหรับ-target"><a class="header" href="#กำหนด-ssh-สำหรับ-target">กำหนด SSH สำหรับ Target</a></h2>
<p>การกำหนด SSH Key</p>
<ul>
<li>โดยปกติแล้ว Ansible จะเชื่อมต่อกับเซิร์ฟเวอร์ตามที่เราระบุผ่าน SSH config และจะพยายามใช้ SSH key ในการเชื่อมต่อ (ถ้ามี) หากไฟล์ private key ของคุณไม่ใช่ชื่อ ~/.ssh/id_rsa คุณสามารถระบุคีย์ที่ใช้สำหรับแต่ละโฮสต์ในไฟล์ inventory ได้:</li>
</ul>
<pre><code>[groupname]
host1 ansible_private_key_file="/home/user/.ssh/privatekey1"
host2 ansible_private_key_file="/home/user/.ssh/privatekey2"
</code></pre>
<ul>
<li>หากทุกเซิร์ฟเวอร์ในกลุ่มใช้คีย์เดียวกัน คุณสามารถกำหนดคีย์เป็นตัวแปรของกลุ่มได้เช่นกัน:</li>
</ul>
<pre><code>[groupname]
host1
host2

[groupname:vars]
ansible_private_key_file="/home/user/.ssh/privatekey1"
</code></pre>
<p>หรือหากเราต้องการใช้รหัสผ่านในการเชื่อมต่อ (ไม่แนะนำ) สามารถตั้งรหัสผ่านไว้ให้แต่ละ host ได้ (ย้ำว่าไม่แนะนำ อย่าหาทำ) ลักษณะดังนี้</p>
<pre><code>[groupname]
host1 ansible_password="123456"
host2 ansible_password="abcdef"
</code></pre>
<p>เมื่อได้ inventory แล้วสามารถทดสอบการเชื่อมต่อไปหา host ปลายทางได้โดยใช้คำสั่งดังนี้</p>
<pre><code>ansible -i hosts -m ping all 
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="การสราง-ssh-key"><a class="header" href="#การสราง-ssh-key">การสร้าง ssh-key</a></h1>
<p>การสร้าง SSH key ใน Linux เป็นขั้นตอนที่สำคัญในการตั้งค่าการเชื่อมต่อ SSH ที่ปลอดภัยระหว่างเครื่องของคุณกับเซิร์ฟเวอร์ระยะไกล นี่คือวิธีการสร้าง SSH key:</p>
<ol>
<li>
<p>เปิด Terminal
คุณจะต้องเปิด Terminal หรือคอนโซลบนระบบ Linux ของคุณ</p>
</li>
<li>
<p>สร้าง SSH Key
ใช้คำสั่ง ssh-keygen เพื่อสร้าง SSH key ใหม่:</p>
</li>
</ol>
<pre><code>ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
</code></pre>
<p>เช่น</p>
<pre><code>[vagrant@centos9s ~]$ ssh-keygen -t rsa -b 4096 -C "sawangpong@example.com"
</code></pre>
<p>รายละเอียดคำสั่ง:</p>
<ul>
<li><strong>-t rsa:</strong> กำหนดประเภทของคีย์ที่ต้องการสร้าง (RSA เป็นประเภทที่ใช้กันทั่วไป)</li>
<li><strong>-b 4096:</strong> กำหนดขนาดของคีย์ (4096 บิตคือขนาดที่แนะนำสำหรับความปลอดภัยที่ดี หรือ 2048 ถ้าต้องการให้ key มีขนาดเล็กลง)</li>
<li><strong>-C "your_email@example.com":</strong> เพิ่มคอมเมนต์หรือคำอธิบายให้กับคีย์ (มักจะใช้เพื่อการระบุ)</li>
</ul>
<ol start="3">
<li>กำหนดที่เก็บและชื่อไฟล์
เมื่อคุณรันคำสั่งนี้ ระบบจะถามให้คุณระบุที่เก็บไฟล์คีย์และชื่อไฟล์:</li>
</ol>
<pre><code>Enter file in which to save the key (/home/username/.ssh/id_rsa):
</code></pre>
<p>หากคุณต้องการใช้ชื่อไฟล์เริ่มต้น (เช่น id_rsa), กด Enter ผ่าน หากต้องการเก็บคีย์ในที่อื่นหรือชื่ออื่น, ให้พิมพ์ที่อยู่และชื่อไฟล์ใหม่</p>
<ol start="4">
<li>ตั้งรหัสผ่าน (Passphrase)
ระบบจะถามให้คุณป้อนรหัสผ่าน (passphrase) เพื่อเพิ่มความปลอดภัย ในการใช้งาน key:</li>
</ol>
<pre><code>Enter passphrase (empty for no passphrase):
</code></pre>
<p>สามารถป้อนรหัสผ่านเพื่อเพิ่มชั้นความปลอดภัยเพิ่มเติม หรือกด Enter เพื่อไม่ใช้รหัสผ่าน</p>
<ol start="5">
<li>ตรวจสอบการสร้างคีย์
เมื่อเสร็จสิ้นการสร้างคีย์, คุณจะเห็นข้อความเช่นนี้:</li>
</ol>
<pre><code>Your identification has been saved in /home/username/.ssh/id_rsa.
Your public key has been saved in /home/username/.ssh/id_rsa.pub.
</code></pre>
<p>ไฟล์ที่สร้างขึ้น:</p>
<ul>
<li><strong>id_rsa:</strong> เป็นไฟล์ private key</li>
<li><strong>id_rsa.pub:</strong> เป็นไฟล์ public key</li>
</ul>
<pre><code>[vagrant@centos9s ~]$ ssh-keygen -t rsa -b 4096 -C "sawangpong@example.com"
Generating public/private rsa key pair.
Enter file in which to save the key (/home/vagrant/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/vagrant/.ssh/id_rsa
Your public key has been saved in /home/vagrant/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:DrJT09yI1VHxKYYz9uOzarAnnOKrmG89f6nmoG2YcsI sawangpong@example.com
The key's randomart image is:
+---[RSA 4096]----+
|          ..o.   |
|         . o . . |
|        . * o o  |
|       = + = .   |
|    . = S . o    |
|     + +.  . .   |
| .  o+...+ .o    |
|  Eo=+=.* =  o   |
|  o*+++B+*...    |
+----[SHA256]-----+
[vagrant@centos9s ~]$
</code></pre>
<pre><code>[vagrant@centos9s ~]$ ll -l ~/.ssh/
total 20
-rw-------. 1 vagrant vagrant   89 Aug  5 16:08 authorized_keys
-rw-------. 1 vagrant vagrant 3389 Aug  6 02:57 id_rsa
-rw-r--r--. 1 vagrant vagrant  748 Aug  6 02:57 id_rsa.pub
-rw-------. 1 vagrant vagrant  837 Aug  5 16:41 known_hosts
-rw-r--r--. 1 vagrant vagrant   95 Aug  5 16:28 known_hosts.old
[vagrant@centos9s ~]$
</code></pre>
<ol start="6">
<li>เพิ่ม Public Key ไปยังเซิร์ฟเวอร์
เพื่อให้สามารถเชื่อมต่อกับเซิร์ฟเวอร์ระยะไกลด้วย SSH key, คุณจะต้องเพิ่ม public key (id_rsa.pub) ไปยังไฟล์ ~/.ssh/authorized_keys บนเซิร์ฟเวอร์:</li>
</ol>
<ul>
<li>6.1 คัดลอก Public Key ไปยัง Clipboard:</li>
</ul>
<pre><code>cat ~/.ssh/id_rsa.pub
</code></pre>
<p>เช่น</p>
<pre><code>[vagrant@centos9s ~]$ cat ~/.ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC5lsNmXAU4PhS4GRYSidXCnFsGsF9ZQ8vbWCAuVAHm2cYzIpboz+OLqC1z3a/ZRIF3cn9JCioDIxGfEPnOFu2DWAj20QKNvbPKpOV3Uc40OU9c99IteYfwsdoJhl1FNzaXaOVHpiVAcSXmt+DbuI7rQZJEpwmG+3Fv9i9ul3jWrhF4KNmOPJTrHbYUgc1R3sxEHOKPlvPHPxP03FEgvS0Kl8BAfjl/0lXfuXLbAEaXN1fiHCAstfrRxp7CmX683sQxUVv8ZzA14lFM8pzvQeriz2m7+b5W7NfUs5Od5EiBPVkSfhj8sMiB1//6Etejgs/mefPGnuC5kvgjAaHRyRlJETmnjdCiXJzcF3i3/vS2SJBqlmU++1MxVCmp14F9tYgb/hriojeSq+Gedd86MnFLbOc+TpyjZnpApNdV5an/7AH7CKleEV2BPgTkdhygAIgJLxnU7ti2ph8OYW1f2Ek2u8AQrnmKsuAd7rHyduhlUF9T+HeOwYptIjh+1b0ACY/eq2GFQG2zEx87B4iERbN0H0CZI47aQhss9tRzBst93aoSI0UnhmVO4o6civWezZMxzXn7WZm6Ip8wsKQK5g9a9jlZY+wwFIaYBKhJYKildk01Pk0eXgDX7U47ZsRoO1RJi+WunOIdkfI6HeghOPN0CqmIwN+p3yGXFUx3/qDzBQ== sawangpong@example.com
</code></pre>
<p><img src="module1/../assets/images/ansible-copy-ssh.png" alt="" /></p>
<p>คัดลอกผลลัพธ์จากคำสั่งนี้ เพิ่ม Public Key ไปยัง Authorized Keys ( ~/.ssh/authorized_keys) บนเซิร์ฟเวอร์:</p>
<ul>
<li>6.2 ใช้คำสั่ง ssh-copy-id เพื่อคัดลอกคีย์ของคุณไปยังเซิร์ฟเวอร์ auto:</li>
</ul>
<pre><code>ssh-copy-id user@remote_server
</code></pre>
<ul>
<li>6.3 หรือเชื่อมต่อด้วย SSH และเพิ่มคีย์ด้วยตนเอง แบบ manual:</li>
</ul>
<pre><code>ssh user@remote_server
จากนั้นเพิ่ม public key ไปที่ไฟล์ ~/.ssh/authorized_keys บนเซิร์ฟเวอร์:
</code></pre>
<pre><code>echo "your_public_key_content" &gt;&gt; ~/.ssh/authorized_keys
</code></pre>
<p>ตรวจสอบให้แน่ใจว่าไฟล์ authorized_keys มีสิทธิ์ที่ถูกต้อง:</p>
<pre><code>chmod 600 ~/.ssh/authorized_key
</code></pre>
<ol start="7">
<li>ทดสอบการเชื่อมต่อ
ทดสอบการเชื่อมต่อด้วย SSH:</li>
</ol>
<pre><code>ssh user@remote_server
</code></pre>
<p>หากทุกอย่างถูกต้อง จะเข้าสู่เซิร์ฟเวอร์โดยไม่ต้องป้อนรหัสผ่าน (ถ้าคุณไม่ได้ตั้งรหัสผ่านสำหรับ SSH key)</p>
<p><strong>สรุป</strong></p>
<p>การสร้าง SSH key และตั้งค่าให้ถูกต้องเป็นขั้นตอนที่สำคัญในการทำให้การเชื่อมต่อ SSH มีความปลอดภัยและสะดวกสบายมากขึ้น โดยการทำตามขั้นตอนที่ระบุข้างต้น คุณจะสามารถสร้าง SSH key ใหม่และตั้งค่าให้พร้อมใช้งานได้</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="การใชงาน-yaml"><a class="header" href="#การใชงาน-yaml">การใช้งาน yaml</a></h1>
<h2 id="yaml-คืออะไร"><a class="header" href="#yaml-คืออะไร">YAML คืออะไร?</a></h2>
<p>YAML เป็นรูปแบบการจัดระเบียบข้อมูลที่อ่านง่ายและเข้าใจง่าย ใช้สำหรับการกำหนดค่าต่างๆ และเป็นที่นิยมในไฟล์การตั้งค่า, การจัดการการกำหนดค่า, และการแลกเปลี่ยนข้อมูลระหว่างแอปพลิเคชัน</p>
<h2 id="โครงสรางพืนฐานของ-yaml"><a class="header" href="#โครงสรางพืนฐานของ-yaml">โครงสร้างพื้นฐานของ YAML</a></h2>
<ol>
<li><strong>Key-Value Pairs:</strong> ข้อมูลใน YAML ถูกจัดระเบียบเป็นคู่คีย์-ค่า (key-value pairs) ซึ่งคีย์และค่าถูกแยกด้วยเครื่องหมาย :</li>
</ol>
<p>2 <strong>Indentation: YAML</strong> ใช้การจัดระเบียบข้อมูลด้วยการเยื้อง (indentation) ซึ่งใช้การเยื้องด้วยช่องว่าง (spaces) ไม่ใช้แท็บ (tabs)</p>
<p>3 <strong>Lists:</strong> ข้อมูล (lists) ใน YAML ใช้สัญลักษณ์ - ที่หน้าแถว</p>
<p>4 <strong>Dictionaries:</strong> ข้อมูลแบบ (dictionaries) หรือแผนที่ (maps) ใน YAML</p>
<pre><code># ข้อมูลเกี่ยวกับผู้ใช้
user:
  name: John Doe
  age: 30
  email: john.doe@example.com
  address:
    street: 123 Main St
    city: Anytown
    postal_code: 12345

# ข้อมูลเกี่ยวกับรายการสินค้า
products:
  - id: 1
    name: Widget
    price: 19.99
    available: true
  - id: 2
    name: Gadget
    price: 29.99
    available: false

# ข้อมูลการตั้งค่า
settings:
  theme: dark
  notifications:
    email: true
    sms: false
  language: en
</code></pre>
<h2 id="ขอมูลเกียวกับผูใช"><a class="header" href="#ขอมูลเกียวกับผูใช">ข้อมูลเกี่ยวกับผู้ใช้</a></h2>
<ul>
<li><strong>Name:</strong> John Doe</li>
<li><strong>Age:</strong> 30</li>
<li><strong>Email:</strong> john.doe@example.com</li>
</ul>
<p><strong>Address:</strong></p>
<ul>
<li><strong>Street:</strong> 123 Main St</li>
<li><strong>City:</strong> Anytown</li>
<li><strong>Postal Code:</strong> 12345</li>
</ul>
<h2 id="ขอมูลเกียวกับรายการสินคา"><a class="header" href="#ขอมูลเกียวกับรายการสินคา">ข้อมูลเกี่ยวกับรายการสินค้า</a></h2>
<ol>
<li>
<p><strong>ID:</strong> 1</p>
<ul>
<li><strong>Name:</strong> Widget</li>
<li><strong>Price:</strong> 19.99</li>
<li><strong>Available:</strong> true</li>
</ul>
</li>
<li>
<p><strong>ID:</strong> 2</p>
<ul>
<li><strong>Name:</strong> Gadget</li>
<li><strong>Price:</strong> 29.99</li>
<li><strong>Available:</strong> false</li>
</ul>
</li>
</ol>
<h2 id="ขอมูลการตังคา"><a class="header" href="#ขอมูลการตังคา">ข้อมูลการตั้งค่า</a></h2>
<ul>
<li><strong>Theme:</strong> dark</li>
<li><strong>Notifications:</strong>
<ul>
<li><strong>Email:</strong> true</li>
<li><strong>SMS:</strong> false</li>
</ul>
</li>
<li><strong>Language:</strong> en</li>
</ul>
<h2 id="สรุปความแตกตางระหวาง-yaml-กับ-json"><a class="header" href="#สรุปความแตกตางระหวาง-yaml-กับ-json">สรุปความแตกต่างระหว่าง YAML กับ JSON</a></h2>
<div class="table-wrapper"><table><thead><tr><th>คุณสมบัติ</th><th>JSON</th><th>YAML</th></tr></thead><tbody>
<tr><td><strong>คืออะไร</strong></td><td>รูปแบบการแปลงข้อมูลเป็นอนุกรมเพื่อแลกเปลี่ยนข้อมูลที่มีโครงสร้างระหว่างแอปพลิเคชันและบริการซอฟต์แวร์ ให้ความสำคัญกับการใช้แอปพลิเคชันมากกว่าการใช้มนุษย์</td><td>รูปแบบการแปลงข้อมูลเป็นอนุกรมเพื่อแลกเปลี่ยนข้อมูลที่มีโครงสร้างระหว่างแอปพลิเคชันและบริการซอฟต์แวร์ ให้ความสำคัญกับการใช้มนุษย์มากกว่าการใช้แอปพลิเคชัน</td></tr>
<tr><td><strong>กรณีการใช้งานหลัก</strong></td><td>แพร่หลายในแพลตฟอร์ม ภาษา การสื่อสารบนซอฟต์แวร์แบบกระจาย แอปบนเว็บ ไฟล์การกำหนดค่า และ API</td><td>ไฟล์การกำหนดค่าในระบบอัตโนมัติ, DevOps และเครื่องมือและบริการ Infrastructure as Code (IaC)</td></tr>
<tr><td><strong>ความสามารถในการอ่าน</strong></td><td>ง่ายสุดๆ</td><td>ง่ายที่สุด</td></tr>
<tr><td><strong>ประเภทข้อมูล</strong></td><td>จำนวน, บูลีน, null, สตริง, อาร์เรย์ และอ็อบเจกต์</td><td>รองรับข้อมูลทุกประเภทผ่านการเก็บรวบรวมข้อมูลที่ซ้อนกันซึ่งประกอบด้วยลำดับ สเกลาร์ และการแมพ</td></tr>
<tr><td><strong>รองรับความคิดเห็น</strong></td><td>ไม่ได้</td><td>ใช่</td></tr>
<tr><td><strong>รองรับอ็อบเจกต์ข้อมูลเป็นค่า</strong></td><td>ใช่</td><td>ไม่ได้</td></tr>
<tr><td><strong>การจัดเวอร์ชัน</strong></td><td>มี แต่ไม่ง่ายที่จะอ่านและทำความเข้าใจความแตกต่างระหว่างเวอร์ชันได้อย่างรวดเร็ว</td><td>มี และง่ายต่อการอ่านและทำความเข้าใจความแตกต่างระหว่างเวอร์ชันได้อย่างรวดเร็ว</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="workshop-ansible"><a class="header" href="#workshop-ansible">Workshop Ansible</a></h1>
<h2 id="ขันตอนการสราง-single-node-lamp-stack-ดวย-vagrant-2"><a class="header" href="#ขันตอนการสราง-single-node-lamp-stack-ดวย-vagrant-2">ขั้นตอนการสร้าง Single Node LAMP Stack ด้วย Vagrant</a></h2>
<h3 id="1-การตังคาโปรเจค-2"><a class="header" href="#1-การตังคาโปรเจค-2">1. การตั้งค่าโปรเจค</a></h3>
<ol>
<li>
<p>เปิดเทอร์มินัลหรือ PowerShell</p>
</li>
<li>
<p>สร้างไดเรกทอรีใหม่สำหรับโปรเจค</p>
<pre><code class="language-sh">mkdir vagrant-ansible
cd vagrant-ansible
</code></pre>
</li>
<li>
<p>สร้าง Vagrantfile  <code>code Vagrantfile</code></p>
</li>
</ol>
<pre><code class="language-ruby"># -*- mode: ruby -*-
# vi: set ft=ruby :

# All Vagrant configuration is done below. The "2" in Vagrant.configure
# configures the configuration version (we support older styles for
# backwards compatibility). Please don't change it unless you know what
# you're doing.

$script=&lt;&lt;-SCRIPT
     sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config    
     systemctl restart sshd.service
     #sudo dnf install -y epel-release
     #sudo dnf install -y ansible
SCRIPT

Vagrant.configure("2") do |config|

  config.vm.box = "generic/centos9s"

  config.vm.network "private_network", ip: "192.168.33.20"
  #config.vm.network "public_network"
  config.vm.synced_folder ".", "/vagrant"
  config.vm.provider "virtualbox" do |vb|
    vb.memory = "2048"
    vb.cpus = 2
  end

  config.vm.provision "shell", inline: $script
end

</code></pre>
<p>Run:</p>
<pre><code class="language-sh">vagrant up
</code></pre>
<p>Login ด้วย คำสั่ง vagrant</p>
<pre><code>vagrant ssh
</code></pre>
<p>หรือ ใช้คำสั่ง ssh</p>
<pre><code>ssh vagrant@192.168.33.20
</code></pre>
<p>ติดตั้ง Ansible แบบ manual</p>
<pre><code>[vagrant@centos9s ~]$ sudo dnf install -y epel-release
[vagrant@centos9s ~]$ sudo dnf install -y ansible
Last metadata expiration check: 0:00:48 ago on Thu 01 Aug 2024 01:27:45 PM UTC.
Dependencies resolved.
========================================================================================================
 Package                        Architecture     Version                      Repository           Size
========================================================================================================
Installing:
 ansible                        noarch           1:7.7.0-1.el9                epel                 34 M
Installing dependencies:
 ansible-core                   x86_64           1:2.14.17-1.el9              appstream           2.6 M
 git-core                       x86_64           2.43.5-1.el9                 appstream           4.4 M
 python3-cffi                   x86_64           1.14.5-5.el9                 baseos              253 k
 python3-cryptography           x86_64           36.0.1-4.el9                 baseos              1.2 M
 python3-packaging              noarch           20.9-5.el9                   appstream            77 k
 python3-ply                    noarch           3.11-14.el9                  baseos              106 k
 python3-pycparser              noarch           2.20-6.el9                   baseos              135 k
 python3-pyyaml                 x86_64           5.4.1-6.el9                  baseos              205 k
 python3-resolvelib             noarch           0.5.4-5.el9                  appstream            34 k
 python3-setuptools             noarch           53.0.0-13.el9                baseos              943 k
 sshpass                        x86_64           1.09-4.el9                   appstream            28 k

Transaction Summary
========================================================================================================
Install  12 Packages

Total download size: 44 M
Installed size: 407 M
Is this ok [y/N]: y
Downloading Packages:
(1/12): python3-ply-3.11-14.el9.noarch.rpm                              141 kB/s | 106 kB     00:00
(2/12): python3-cffi-1.14.5-5.el9.x86_64.rpm                            268 kB/s | 253 kB     00:00
(3/12): python3-pyyaml-5.4.1-6.el9.x86_64.rpm                           825 kB/s | 205 kB     00:00
(4/12): python3-pycparser-2.20-6.el9.noarch.rpm                         117 kB/s | 135 kB     00:01
(5/12): python3-cryptography-36.0.1-4.el9.x86_64.rpm                    530 kB/s | 1.2 MB     00:02
(6/12): python3-setuptools-53.0.0-13.el9.noarch.rpm                     680 kB/s | 943 kB     00:01
(7/12): python3-packaging-20.9-5.el9.noarch.rpm                         145 kB/s |  77 kB     00:00
(8/12): python3-resolvelib-0.5.4-5.el9.noarch.rpm                       237 kB/s |  34 kB     00:00
(9/12): sshpass-1.09-4.el9.x86_64.rpm                                   217 kB/s |  28 kB     00:00
(10/12): ansible-core-2.14.17-1.el9.x86_64.rpm                          1.6 MB/s | 2.6 MB     00:01
(11/12): git-core-2.43.5-1.el9.x86_64.rpm                               1.5 MB/s | 4.4 MB     00:02
(12/12): ansible-7.7.0-1.el9.noarch.rpm                                 4.6 MB/s |  34 MB     00:07
--------------------------------------------------------------------------------------------------------
Total                                                                   2.9 MB/s |  44 MB     00:15
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                                                1/1
  Installing       : sshpass-1.09-4.el9.x86_64                                                     1/12
  Installing       : python3-resolvelib-0.5.4-5.el9.noarch                                         2/12
  Installing       : python3-packaging-20.9-5.el9.noarch                                           3/12
  Installing       : git-core-2.43.5-1.el9.x86_64                                                  4/12
  Installing       : python3-setuptools-53.0.0-13.el9.noarch                                       5/12
  Installing       : python3-pyyaml-5.4.1-6.el9.x86_64                                             6/12
  Installing       : python3-ply-3.11-14.el9.noarch                                                7/12
  Installing       : python3-pycparser-2.20-6.el9.noarch                                           8/12
  Installing       : python3-cffi-1.14.5-5.el9.x86_64                                              9/12
  Installing       : python3-cryptography-36.0.1-4.el9.x86_64                                     10/12
  Installing       : ansible-core-1:2.14.17-1.el9.x86_64                                          11/12
  Installing       : ansible-1:7.7.0-1.el9.noarch                                                 12/12
  Running scriptlet: ansible-1:7.7.0-1.el9.noarch                                                 12/12
  Verifying        : python3-cffi-1.14.5-5.el9.x86_64                                              1/12
  Verifying        : python3-cryptography-36.0.1-4.el9.x86_64                                      2/12
  Verifying        : python3-ply-3.11-14.el9.noarch                                                3/12
  Verifying        : python3-pycparser-2.20-6.el9.noarch                                           4/12
  Verifying        : python3-pyyaml-5.4.1-6.el9.x86_64                                             5/12
  Verifying        : python3-setuptools-53.0.0-13.el9.noarch                                       6/12
  Verifying        : ansible-core-1:2.14.17-1.el9.x86_64                                           7/12
  Verifying        : git-core-2.43.5-1.el9.x86_64                                                  8/12
  Verifying        : python3-packaging-20.9-5.el9.noarch                                           9/12
  Verifying        : python3-resolvelib-0.5.4-5.el9.noarch                                        10/12
  Verifying        : sshpass-1.09-4.el9.x86_64                                                    11/12
  Verifying        : ansible-1:7.7.0-1.el9.noarch                                                 12/12

Installed:
  ansible-1:7.7.0-1.el9.noarch                         ansible-core-1:2.14.17-1.el9.x86_64
  git-core-2.43.5-1.el9.x86_64                         python3-cffi-1.14.5-5.el9.x86_64
  python3-cryptography-36.0.1-4.el9.x86_64             python3-packaging-20.9-5.el9.noarch
  python3-ply-3.11-14.el9.noarch                       python3-pycparser-2.20-6.el9.noarch
  python3-pyyaml-5.4.1-6.el9.x86_64                    python3-resolvelib-0.5.4-5.el9.noarch
  python3-setuptools-53.0.0-13.el9.noarch              sshpass-1.09-4.el9.x86_64

Complete!
</code></pre>
<pre><code>[vagrant@centos9s ~]$ sudo dnf info ansible
Extra Packages for Enterprise Linux 9 - x86_64                          3.4 kB/s | 4.6 kB     00:01
Installed Packages
Name         : ansible
Epoch        : 1
Version      : 7.7.0
Release      : 1.el9
Architecture : noarch
Size         : 365 M
Source       : ansible-7.7.0-1.el9.src.rpm
Repository   : @System
From repo    : epel
Summary      : Curated set of Ansible collections included in addition to ansible-core
URL          : https://ansible.com
License      : GPL-3.0-or-later AND Apache-2.0 AND BSD-2-Clause AND BSD-3-Clause AND MIT AND MPL-2.0 AND
             : PSF-2.0
Description  : Ansible is a radically simple model-driven configuration management,
             : multi-node deployment, and remote task execution system. Ansible works
             : over SSH and does not require any software or daemons to be installed
             : on remote nodes. Extension modules can be written in any language and
             : are transferred to managed machines automatically.
             :
             : This package provides a curated set of Ansible collections included in addition
             : to ansible-core.
</code></pre>
<pre><code>[vagrant@centos9s ~]$ sudo dnf info ansible-core
Extra Packages for Enterprise Linux 9 - Next - x86_64                    11 kB/s |  17 kB     00:01
Installed Packages
Name         : ansible-core
Epoch        : 1
Version      : 2.14.17
Release      : 1.el9
Architecture : x86_64
Size         : 10 M
Source       : ansible-core-2.14.17-1.el9.src.rpm
Repository   : @System
From repo    : appstream
Summary      : SSH-based configuration management, deployment, and task execution system
URL          : http://ansible.com
License      : GPLv3+
Description  : Ansible is a radically simple model-driven configuration management,
             : multi-node deployment, and remote task execution system. Ansible works
             : over SSH and does not require any software or daemons to be installed
             : on remote nodes. Extension modules can be written in any language and
             : are transferred to managed machines automatically.
</code></pre>
<p>Run คำสั่งเพื่อ อ่าน คู่มือการใช้</p>
<pre><code>man ansible
</code></pre>
<p><img src="module1/../assets/images/ansible_man.png" alt="" /></p>
<p>Run คำสั่ง</p>
<pre><code>[vagrant@centos9s ~]$ ansible --version
ansible [core 2.14.17]
  config file = /etc/ansible/ansible.cfg
  configured module search path = ['/home/vagrant/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/lib/python3.9/site-packages/ansible
  ansible collection location = /home/vagrant/.ansible/collections:/usr/share/ansible/collections
  executable location = /usr/bin/ansible
  python version = 3.9.18 (main, Sep  7 2023, 00:00:00) [GCC 11.4.1 20230605 (Red Hat 11.4.1-2)] (/usr/bin/python3)
  jinja version = 3.1.2
  libyaml = True
</code></pre>
<h1 id="เริมตนการใชงาน-ansible"><a class="header" href="#เริมตนการใชงาน-ansible">เริ่มต้นการใช้งาน Ansible</a></h1>
<p>คำสั่ง ใน Anible มีอยู่ด้วยกัน 2 คำสั่ง คือ <code>ansible</code> และ <code>ansible-playbook</code> มีรูปแบบในการใชงานคำสั่งดังนี้</p>
<p>ansible:</p>
<pre><code>ansible -i &lt;inventory_file&gt; &lt;host patterns&gt; -m &lt;module&gt;
</code></pre>
<p>ansible-playbook:</p>
<pre><code>ansible-playbook -i &lt;inventory_file&gt; &lt;playbook_file&gt; 
</code></pre>
<h2 id="test-connection-ไปยัง-host"><a class="header" href="#test-connection-ไปยัง-host">Test Connection ไปยัง Host</a></h2>
<p>Run คำสั่ง  check connection ด้วย module ชื่อ ping</p>
<pre><code>ansible localhost -m ping
</code></pre>
<p>โดยคำสั่ง <code>ansible localhost -h ping</code> เป็นการใช้ทดสอบ connectivity ไปยัง localhost สามารถแยกคำสั่งได้ดังนี้</p>
<ul>
<li><strong>ansible:</strong> เครื่องมือบรรทัดคำสั่งสำหรับการรันคำสั่ง ad-hoc ด้วย Ansible</li>
<li><strong>localhost:</strong> โฮสต์เป้าหมายสำหรับคำสั่ง Ansible ในกรณีนี้คือเครื่องของเราเอง</li>
<li><strong>-m ping:</strong> ตัวเลือก -m ใช้เพื่อระบุโมดูลที่ต้องการใช้ โดย ping เป็นโมดูลง่ายๆ ของ Ansible ที่ตรวจสอบว่าเป้าหมายสามารถเข้าถึงได้หรือไม่</li>
</ul>
<p>Result</p>
<pre><code>localhost | SUCCESS =&gt; {
    "changed": false,
    "ping": "pong"
}
</code></pre>
<p>ซึ่งหมายความว่าโมดูล ping ได้ทำการติดต่อกับ localhost สำเร็จ และได้รับการตอบกลับเป็น "pong" แสดงว่าการเชื่อมต่อนั้นดี หากมีข้อผิดพลาด ข้อความที่แสดงจะช่วยให้คุณสามารถวิเคราะห์ปัญหาได้ครับ</p>
<p>Run คำสั่ง ด้วย <code>module command</code> เพื่อส่งคำสั่งที่เราต้องการ ไปทำงาน ใน server เป้าหมาย</p>
<pre><code>[vagrant@centos9s ~]$ ansible localhost -m command -a "uptime"
localhost | CHANGED | rc=0 &gt;&gt;
 13:51:41 up 33 min,  1 user,  load average: 0.08, 0.05, 0.08
</code></pre>
<p>ผลลัพธ์ที่ได้จากคำสั่งนี้จะเป็นการแสดงระยะเวลาที่เครื่องทำงานมาตั้งแต่การเริ่มต้นเครื่อง</p>
<p><strong>รายละเอียด คำสั่ง:</strong>  <code>ansible localhost -m command -a "uptime"</code> ทำงานดังนี้:</p>
<ul>
<li><strong>ansible:</strong> เครื่องมือบรรทัดคำสั่งสำหรับการรันคำสั่ง ad-hoc ด้วย Ansible</li>
<li><strong>localhost:</strong> โฮสต์เป้าหมายที่คำสั่ง Ansible จะถูกส่งไป ซึ่งในกรณีนี้คือตัวเครื่องของคุณเอง</li>
<li><strong>-m command:</strong> ตัวเลือก <code>-m</code> ใช้เพื่อระบุโมดูลที่ต้องการใช้ ในที่นี้คือโมดูล <code>command</code> ซึ่งใช้สำหรับรันคำสั่งทั่วไป</li>
<li><strong>-a "uptime":</strong> ตัวเลือก <code>-a</code> ใช้เพื่อระบุพารามิเตอร์ของโมดูล ในที่นี้คือคำสั่ง <code>uptime</code> ซึ่งจะแสดงระยะเวลาที่เครื่องทำงานอยู่</li>
</ul>
<h2 id="กำหนดคาของ-host-สำหรับ-ansible"><a class="header" href="#กำหนดคาของ-host-สำหรับ-ansible">กำหนดค่าของ Host สำหรับ Ansible</a></h2>
<p>เพิ่ม  ansible host ใน file <code>/etc/ansible/hosts</code> และต้องใช้สิทธิของผู้ดูแลระบบ เรียก file นี้ว่า Inventory</p>
<pre><code>ls /etc/ansible
sudo vim /etc/ansible/hosts
</code></pre>
<p>content: /etc/ansible/hosts ต่อท้าย ของ file</p>
<pre><code>[servers]
server1 ansible_host=192.168.33.20
</code></pre>
<p>and test ansible add hoc command</p>
<pre><code>ansible -m ping servers
</code></pre>
<p>หรือ <code>[vagrant@centos9s ~]$ ansible servers -i /etc/ansible/hosts -m ping</code>
หรือ <code>[vagrant@centos9s ~]$ ansible server1 -i /etc/ansible/hosts -m ping</code></p>
<p>Errors:</p>
<pre><code>[vagrant@centos9s ~]$ ansible -m ping servers
The authenticity of host '192.168.33.20 (192.168.33.20)' can't be established.
ED25519 key fingerprint is SHA256:0pRyAhg91dyKvyciyc8HBUSDZ8eCkTh60zcecnNZFso.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes

server1 | UNREACHABLE! =&gt; {
    "changed": false,
    "msg": "Failed to connect to the host via ssh: Warning: Permanently added '192.168.33.20' (ED25519) to the list of known hosts.\r\nvagrant@192.168.33.20: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).",
    "unreachable": true
}
</code></pre>
<p>Error ที่เห็น เป็น Error ปรกติ เนื่องจาก ไม่สามารถ authentication ไปยังเครื่องเป้าหมายได้</p>
<h2 id="การกำหนดรูปแบบของการทำ-authentication"><a class="header" href="#การกำหนดรูปแบบของการทำ-authentication">การกำหนดรูปแบบของการทำ Authentication</a></h2>
<p>Ansible ใช้วิธีการหลายวิธีในการทำการ authentication (การตรวจสอบสิทธิ์) กับโฮสต์ที่มันจัดการ ซึ่งวิธีที่ใช้จะขึ้นอยู่กับประเภทของการเชื่อมต่อที่คุณเลือกใช้ นี่คือวิธีการหลัก ๆ ที่ใช้ในการ authentication:</p>
<h3 id="วิธีที-1-การใช-ssh-key-based-authentication"><a class="header" href="#วิธีที-1-การใช-ssh-key-based-authentication">วิธีที่ 1 การใช้ SSH Key-Based Authentication</a></h3>
<p>เป็นวิธีที่นิยมที่สุดในการทำการ authentication ไปยังโฮสต์:</p>
<ul>
<li><strong>การตั้งค่า:</strong>
<ul>
<li>สร้างคู่คีย์ SSH (private และ public) และคัดลอกคีย์ public ไปยังโฟลเดอร์ ~/.ssh/authorized_keys บนโฮสต์เป้าหมาย
การใช้งาน: ในการเชื่อมต่อ Ansible จะใช้คีย์ private ของคุณเพื่อทำการล็อกอินไปยังโฮสต์เป้าหมาย
การกำหนดค่าใน Ansible: โดยทั่วไป Ansible ใช้คีย์ส่วนตัวที่อยู่ใน ~/.ssh/id_rsa หากคุณใช้คีย์ที่ต่างออกไป คุณสามารถกำหนดค่าในไฟล์ ansible.cfg หรือระบุผ่านตัวเลือก --private-key</li>
</ul>
</li>
</ul>
<pre><code>[vagrant@centos9s ~]$ ansible server1 -i /etc/ansible/hosts -m ping
server1 | UNREACHABLE! =&gt; {
    "changed": false,
    "msg": "Failed to connect to the host via ssh: vagrant@192.168.33.20: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).",
    "unreachable": true
}
</code></pre>
<h3 id="วิธีที-2-การใช-password-based-authentication"><a class="header" href="#วิธีที-2-การใช-password-based-authentication">วิธีที่ 2 การใช้ Password-Based Authentication</a></h3>
<p>การใช้รหัสผ่านเป็นอีกทางเลือกหนึ่งในการทำการ authentication แต่ไม่เป็นที่นิยมเท่าการใช้ SSH key เพราะมันอาจจะมีความเสี่ยงด้านความปลอดภัย:</p>
<p>การตั้งค่า: ไม่มีการตั้งค่าเพิ่มเติมที่ต้องทำบนโฮสต์เป้าหมาย แต่คุณต้องระบุรหัสผ่านในคำสั่ง Ansible หรือในไฟล์การกำหนดค่า
การใช้งาน: คุณสามารถระบุรหัสผ่านในคำสั่งหรือไฟล์การกำหนดค่า</p>
<ul>
<li><strong>กำหนด username/password  ใน Cli</strong></li>
</ul>
<pre><code>[vagrant@centos9s ~]$ ansible -m ping servers --user vagrant --ask-pass
SSH password:
server1 | SUCCESS =&gt; {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3"
    },
    "changed": false,
    "ping": "pong"
}
</code></pre>
<p>Ansible จะรอให้กรอกรหัสของ user vagrant คือ vagrant</p>
<ul>
<li><strong>กำหนดไว้ใน inventory</strong></li>
</ul>
<pre><code>[servers]
server1 ansible_host=192.168.33.20 ansible_ssh_pass=vagrant
</code></pre>
<ul>
<li><strong>encode password ไว้ใน File</strong></li>
</ul>
<pre><code>[vagrant@centos9s ~]$ ansible-vault create secrets.yml
New Vault password:
Confirm New Vault password:
</code></pre>
<p>หลังจากนั้น จะมี Temp file ให้เรากรอกข้อมูล
<img src="module1/../assets/images/ansible-encrypt.png" alt="" /></p>
<p>ให้กด <code>i</code> สำหรับ mode insert และ
เพ่ิ่ม <code>ansible_ssh_pass: password</code>  ใน Temporary file (file ที่ คำสั่ง ansible-vault เตรียมไว้เรานั้น ใช้ Vi เป็น Editor)</p>
<pre><code>ansible_ssh_pass: vagrant
</code></pre>
<p>ทำการบันทึก ด้วยการกด  <code>:wq!</code></p>
<pre><code>cat secrets.yml
</code></pre>
<p><img src="module1/../assets/images/ansible-encrypt-ascii.png" alt="" /></p>
<ul>
<li>content ใน file จะเป็น ascii text</li>
</ul>
<h3 id="ทำการ-decrypt-ยอนกลับ"><a class="header" href="#ทำการ-decrypt-ยอนกลับ">ทำการ Decrypt ย้อนกลับ</a></h3>
<pre><code>[vagrant@centos9s ~]$ ansible-vault decrypt secrets.yml
Vault password:
Decryption successful
[vagrant@centos9s ~]$ cat secrets.yml
ansible_ssh_pass: vagrant
</code></pre>
<h2 id="workshop-สราง-playbookyml"><a class="header" href="#workshop-สราง-playbookyml">Workshop: สร้าง playbook.yml</a></h2>
<h3 id="สราง-inventory-ของ-project-เอง-ชือวา-host-และ-สราง-playbook-สำหรับการทำ-auto"><a class="header" href="#สราง-inventory-ของ-project-เอง-ชือวา-host-และ-สราง-playbook-สำหรับการทำ-auto">สร้าง inventory ของ Project เอง ชื่อว่า host และ สร้าง playbook สำหรับการทำ Auto</a></h3>
<p>สร้าง playbook.yml</p>
<pre><code>---
# playbook.yml

- name: install nginx and start service
  hosts: web
  become: true
  tasks:

   - name: install nginx
     yum: name=nginx state=present

   - name: start service
     service: name=nginx state=restarted
</code></pre>
<p>สร้าง hosts</p>
<pre><code>[web]
192.168.33.20

[web:vars]
ansible_usr=vagrant
</code></pre>
<p>ตรวจสอบ File System ด้วยคำสั่ง <code>ls -l</code> ได้เห็น file ที่สร้าง</p>
<pre><code>[vagrant@centos9s ~]$ ls -l
total 8
-rw-r--r--. 1 vagrant vagrant  19 Aug  1 12:19 hosts
-rw-r--r--. 1 vagrant vagrant 224 Aug  1 12:20 playbook.yml
</code></pre>
<p>Run</p>
<pre><code>[vagrant@centos9s ~]$ ansible web -i host -m ping
192.168.33.20 | UNREACHABLE! =&gt; {
    "changed": false,
    "msg": "Failed to connect to the host via ssh: vagrant@192.168.33.20: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).",
    "unreachable": true
}
</code></pre>
<pre><code>[vagrant@centos9s ~]$ ansible all -i host -m ping
192.168.33.20 | UNREACHABLE! =&gt; {
    "changed": false,
    "msg": "Failed to connect to the host via ssh: vagrant@192.168.33.20: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).",
    "unreachable": true
}
</code></pre>
<p>Run</p>
<pre><code>ansible-playbook -i host playbook.yml
</code></pre>
<p>โดย default แล้ว ansible เลือกใช้วิธี ssh-key authentication แต่ ซื่งจะต้องทำการ Copy ssh-key จากเครื่อง controller ไปยัง เครื่อง servers ที่ระบุใน inventory</p>
<p>วิธีแรก ลองทดสอบ แบบ password authentication ส่วน user จะเป็นชื่อ user บน shell ของเครื่อง controller (user vagrant)</p>
<pre><code>[web]
192.168.33.20  ansible_ssh_pass=vagrant
</code></pre>
<p>ลองทดสอบอีกครั้ง จะพบว่า error เปลี่ยนเป็น Success</p>
<pre><code>[vagrant@centos9s ~]$ ansible all -i host -m ping
192.168.33.20 | SUCCESS =&gt; {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3"
    },
    "changed": false,
    "ping": "pong"
}
</code></pre>
<p>แต่สำหรับวิธีการใช้ password แบบที่กำหนดค่า password โดยตรงลงไปใน ไฟล์ invetory ทำให้เกิดความเสียงสูง ดังนั้น จะใช้ คำสั่ง <code>ansible-value</code> เพื่อทำการ Encrypt password  โดยใช้คำสั่ง</p>
<pre><code>[vagrant@centos9s ~]$ ansible-vault create secrets.yml
New Vault password:
Confirm New Vault password:
</code></pre>
<p>เพิ่มตัวแปร ไปยัง Temporary File (โดยใช้ VI editor)</p>
<pre><code>ansible_ssh_pass: vagrant
</code></pre>
<p>หลังจากนั้น ansible-vaule จะencrypt password ไปเก็บไว้ใน secrets.yml</p>
<p><img src="module1/../assets/images/secrets_yml.png" alt="" />
ansible_config</p>
<pre><code>[vagrant@centos9s ~]$ ansible all -i host -m ping
192.168.33.20 | SUCCESS =&gt; {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3"
    },
    "changed": false,
    "ping": "pong"
}
</code></pre>
<p>กลับไปที่วิธี ของ ssh key ต้องสร้าง ssh key ก่อน</p>
<pre><code>ssh-keygen -t rsa
</code></pre>
<pre><code>[vagrant@centos9s ~]$ ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/home/vagrant/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/vagrant/.ssh/id_rsa
Your public key has been saved in /home/vagrant/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:toTj+jA2qXwjwVVa3Pt7BS1wpOwHpcZZvZcjVdTRnN8 vagrant@centos9s.localdomain
The key's randomart image is:
+---[RSA 3072]----+
|     . .   .+. +O|
|      + .o.*. .o+|
|     +   .Oo ...+|
|    o  ..o .o.ooE|
| . .  o S.. .o...|
|  o  o + ...  .  |
|   .* . .  . .   |
| ..oo=    . .    |
|  oo.o.    .     |
+----[SHA256]-----+
</code></pre>
<p>copy public key ด้วยคำสั่ง ssh-copy-id ไปยัง server</p>
<pre><code>[vagrant@centos9s ~]$ ssh-copy-id vagrant@192.168.33.20
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/vagrant/.ssh/id_rsa.pub"
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
vagrant@192.168.33.20's password:

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'vagrant@192.168.33.20'"
and check to make sure that only the key(s) you wanted were added.
</code></pre>
<p>อีกขั้นตอน</p>
<pre><code>[web]
192.168.33.20 ansible_ssh_private_key_file=~/.ssh/id_rsa
</code></pre>
<p>คราวนี้ลองทดสอบคำสั่ง อีกครั้ง</p>
<pre><code>[vagrant@centos9s ~]$ ansible all -i host -m ping
192.168.33.20 | SUCCESS =&gt; {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3"
    },
    "changed": false,
    "ping": "pong"
}
</code></pre>
<p>หรือ ให้ระบุ ใน Ansible config file  (<code>ansible.cfg</code>)</p>
<pre><code>[vagrant@centos9s ~]$ sudo vim /etc/ansible/ansible.cfg
</code></pre>
<pre><code>[defaults]
private_key_file =~/.ssh/id_rsa
</code></pre>
<p>Result</p>
<pre><code>[vagrant@centos9s ~]$ ansible all -i host -m ping
192.168.33.20 | SUCCESS =&gt; {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3"
    },
    "changed": false,
    "ping": "pong"
}
</code></pre>
<p><img src="module1/../assets/images/ansible_config.png" alt="" /></p>
<pre><code>[vagrant@centos9s ~]$ ansible-playbook -i host playbook.yml
</code></pre>
<p><img src="module1/../assets/images/ansible_nginx.png" alt="" /></p>
<pre><code>[vagrant@centos9s ~]$ ss -tulpn
Netid      State       Recv-Q      Send-Q            Local Address:Port             Peer Address:Port      Process
udp        UNCONN      0           0                     127.0.0.1:323                   0.0.0.0:*
udp        UNCONN      0           0                         [::1]:323                      [::]:*
tcp        LISTEN      0           511                     0.0.0.0:80                    0.0.0.0:*
tcp        LISTEN      0           128                     0.0.0.0:22                    0.0.0.0:*
tcp        LISTEN      0           511                        [::]:80                       [::]:*
tcp        LISTEN      0           128                        [::]:22                       [::]:*
[vagrant@centos9s ~]$
</code></pre>
<pre><code>vagrant halt
vagrant destroy
</code></pre>
<p>แก้ไขfile Vagrantfile</p>
<pre><code># -*- mode: ruby -*-
# vi: set ft=ruby :

# All Vagrant configuration is done below. The "2" in Vagrant.configure
# configures the configuration version (we support older styles for
# backwards compatibility). Please don't change it unless you know what
# you're doing.

$script=&lt;&lt;-SCRIPT
    sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config    
    systemctl restart sshd.service
SCRIPT

Vagrant.configure("2") do |config|
  # The most common configuration options are documented and commented below.
  # For a complete reference, please see the online documentation at
  # https://docs.vagrantup.com.
  config.vm.box = "generic/centos9s"

  config.vm.define "controller" do |control|
    control.vm.hostname = "controller"
    control.vm.network "private_network", ip: "192.168.33.10"
    control.vm.provider "virtualbox" do |vb|
      vb.memory = "1024"
      vb.cpus = 1
    end

    control.vm.provision "shell", inline: &lt;&lt;-SCRIPT
      sudo hostnamectl set-hostname controller
    SCRIPT
  end

  config.vm.define "web" do |web|
    web.vm.hostname = "controller"
    web.vm.network "private_network", ip: "192.168.33.20"
    web.vm.provider "virtualbox" do |vb|
      vb.memory = "2048"
      vb.cpus = 2
    end
    web.vm.provision "shell", inline: &lt;&lt;-SCRIPT
      sudo hostnamectl set-hostname web
    SCRIPT
  end

  config.vm.define "db" do |db|
    db.vm.hostname = "controller"
    db.vm.network "private_network", ip: "192.168.33.21"
    db.vm.provider "virtualbox" do |vb|
      vb.memory = "4096"
      vb.cpus = 2
    end
    db.vm.provision "shell", inline: &lt;&lt;-SCRIPT
      sudo hostnamectl set-hostname db
    SCRIPT
  end

  config.vm.synced_folder ".", "/vagrant"


  config.vm.provision "shell", inline: $script
end

</code></pre>
<pre><code>vagrant status
vagrant up
</code></pre>
<pre><code>PS C:\Users\sysadmin\VagrantDev\Centos9s&gt; vagrant status
Current machine states:

controller                not created (virtualbox)
web                       not created (virtualbox)
db                        not created (virtualbox)

This environment represents multiple VMs. The VMs are all listed
above with their current state. For more information about a specific
VM, run `vagrant status NAME`.
</code></pre>
<pre><code>PS C:\Users\sysadmin\VagrantDev\Centos9s&gt; vagrant up
Bringing machine 'controller' up with 'virtualbox' provider...
Bringing machine 'web' up with 'virtualbox' provider...
Bringing machine 'db' up with 'virtualbox' provider...
==&gt; controller: Importing base box 'generic/centos9s'...
Progress: 40%
...
</code></pre>
<p>การเข้าถึง vm ให้ใช้ คำสั่ง vagrant ssh ตามด้วยชื่อ</p>
<pre><code>vagrant ssh controller
vagrant ssh web
vagrant ssh db
</code></pre>
<p>playbook.yml</p>
<pre><code>---
# playbook.yml

- name: install nginx and start service
  hosts: web
  become: true
  tasks:

   - name: install nginx
     yum: name=nginx state=present

   - name: start service
     service: name=nginx state=restarted

- name: install nginx and start service
  hosts: db
  become: true
  tasks:

   - name: install db
     yum: name=mysql state=present

   - name: start service
     service: name=mysql state=restarted
</code></pre>
<p><img src="module1/../assets/images/ansible_multinote1.png" alt="" /></p>
<p><img src="module1/../assets/images/ansible_multinote_ping.png" alt="" /></p>
<pre><code>[vagrant@controller ~]$ ansible-playbook -i hosts playbook.yml -vvv
</code></pre>
<pre><code>---
- name: Install and configure Nginx on web servers
  hosts: web
  become: true
  tasks:
    - name: Install Nginx
      yum:
        name: nginx
        state: present

    - name: Start and enable Nginx service
      service:
        name: nginx
        state: started
        enabled: true

- name: Install and configure MySQL on db servers
  hosts: db
  become: true
  vars:
    mysql_root_password: password
  tasks:
    - name: Install MySQL
      yum:
        name: mysql-server
        state: present

    - name: Start and enable MySQL service
      service:
        name: mysqld
        state: started
        enabled: true

    - name: Set MySQL root password
      mysql_user:
        name: root
        password: "{{ mysql_root_password }}"
        host: localhost
        state: present

</code></pre>
<pre><code>Key Changes:
Naming: Changed play names to better describe their purposes.
Service Management: Used state: started instead of state: restarted and added enabled: true to ensure the services start on boot.
MySQL Installation: Changed the package name from mysql to mysql-server (commonly used package name for MySQL).
MySQL Service Name: Changed the service name to mysqld (typical name for MySQL service).
MySQL Root Password: Added a task to set the MySQL root password using the mysql_user module.
Feel free to adj
</code></pre>
<p><img src="module1/../assets/images/ansible_nginx_mysql.png" alt="" /></p>
<pre><code>- name: Install and configure MySQL on db servers
  hosts: db
  become: true
  vars:
    mysql_root_password: password
    ansible_python_interpreter: /usr/bin/python3
    sql_file_path: create_tables.sql  # Update this path to your actual SQL file location
  tasks:
    - name: Install MySQL
      yum:
        name: mysql-server
        state: present

    - name: Start and enable MySQL service
      service:
        name: mysqld
        state: started
        enabled: true
        
    - name: Install python
      yum:
        name: python
        state: present

    - name: Install python-pip
      yum:
        name: python-pip
        state: present

    - name: Install PyMySQL Python library
      pip:
        name: PyMySQL
        state: present

    - name: Set MySQL root password
      mysql_user:
        name: root
        password: "{{ mysql_root_password }}"
        host: localhost
        state: present
      vars:
        ansible_python_interpreter: /usr/bin/python3

    - name: Create tables from SQL file
      mysql_db:
        name: mydatabase
        state: import
        target: "{{ sql_file_path }}"
        login_user: root
        login_password: "{{ mysql_root_password }}"
        login_host: localhost
</code></pre>
<pre><code>CREATE DATABASE IF NOT EXISTS mydatabase;
USE mydatabase;

CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    password VARCHAR(255) NOT NULL
);

CREATE TABLE IF NOT EXISTS orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    order_date DATE,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
</code></pre>
<pre><code>- name: Install and configure MySQL on db servers
  hosts: db
  become: true
  vars:
    mysql_root_password: password
    ansible_python_interpreter: /usr/bin/python3
    sql_file_path: create_tables.sql  # Update this path to your actual SQL file location
  tasks:
    - name: Install MySQL
      yum:
        name: mysql-server
        state: present

    - name: Start and enable MySQL service
      service:
        name: mysqld
        state: started
        enabled: true
        
    - name: Install python
      yum:
        name: python
        state: present

    - name: Install python-pip
      yum:
        name: python-pip
        state: present

    - name: Install PyMySQL Python library
      pip:
        name: PyMySQL
        state: present

    - name: Set MySQL root password
      mysql_user:
        name: root
        password: "{{ mysql_root_password }}"
        host: localhost
        state: present
      vars:
        ansible_python_interpreter: /usr/bin/python3

    - name: Create tables from SQL file
      mysql_db:
        name: mydatabase
        state: import
        target: "{{ sql_file_path }}"
        login_user: root
        login_password: "{{ mysql_root_password }}"
        login_host: localhost
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="./src/js/highlightjs-line-numbers.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
